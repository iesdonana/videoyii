<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/90d046f2/css/bootstrap.css" rel="stylesheet">
<link href="./assets/c6368d94/solarized_light.css" rel="stylesheet">
<link href="./assets/9f5cdd92/style.css" rel="stylesheet">
<script src="./assets/a6e53573/jquery.js"></script>
<script src="./assets/90d046f2/js/bootstrap.js"></script>
<script src="./assets/218ce2e5/jssearch.js"></script>    <title>Bộ lọc (Filters) - Kiến trúc ứng dụng (Application Structure) - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w11788" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w11788-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./guide-index.html">The Definitive Guide to Yii 2.0</a></div><div id="w11788-collapse" class="collapse navbar-collapse"><ul id="w11789" class="navbar-nav nav"><li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-11772" data-toggle="collapse" data-parent="#navigation">Giới thiệu <b class="caret"></b></a><div id="navigation-11772" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">Về Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Nâng cấp lên từ phiên bản 1.1</a></div>
<a class="list-group-item" href="#navigation-11773" data-toggle="collapse" data-parent="#navigation">Bắt đầu <b class="caret"></b></a><div id="navigation-11773" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Cài đặt Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Thực hiện chạy ứng dụng</a>
<a class="list-group-item" href="./guide-start-hello.html">Viết lời chào đầu tiên</a>
<a class="list-group-item" href="./guide-start-forms.html">Làm việc với Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">Làm việc với Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">Sử dụng Gii để sinh code</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Mức cao hơn</a></div>
<a class="list-group-item active" href="#navigation-11774" data-toggle="collapse" data-parent="#navigation">Kiến trúc ứng dụng (Application Structure) <b class="caret"></b></a><div id="navigation-11774" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-structure-overview.html">Tổng quan về kiến trúc ứng dụng</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Mục Scripts</a>
<a class="list-group-item" href="./guide-structure-applications.html">Ứng dụng (Applications)</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Thành phần ứng dụng</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-structure-models.html">Models</a>
<a class="list-group-item" href="./guide-structure-views.html">Views</a>
<a class="list-group-item" href="./guide-structure-modules.html">Modules</a>
<a class="list-group-item active" href="./guide-structure-filters.html">Bộ lọc (Filters)</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Widgets</a>
<a class="list-group-item" href="./guide-structure-assets.html">Assets</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Phần mở rộng (Extensions)</a></div>
<a class="list-group-item" href="#navigation-11775" data-toggle="collapse" data-parent="#navigation">Yêu cầu xử lý (Handling Requests) <b class="caret"></b></a><div id="navigation-11775" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Routing và URL Creation</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Yêu cầu (Requests)</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Responses</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions và Cookies</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Xử lý lỗi (Handling Error)</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Logging</a></div>
<a class="list-group-item" href="#navigation-11776" data-toggle="collapse" data-parent="#navigation">Các khái niệm chính <b class="caret"></b></a><div id="navigation-11776" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Thành phần (Components)</a>
<a class="list-group-item" href="./guide-concept-properties.html">Thuộc tính (Properties)</a>
<a class="list-group-item" href="./guide-concept-events.html">Sự kiện (Events)</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Hành vi (Behaviors)</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Cấu hình (Configurations)</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Bí danh (Aliases)</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Lớp tự động nạp (Autoloading)</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-11777" data-toggle="collapse" data-parent="#navigation">Làm việc với Databases <b class="caret"></b></a><div id="navigation-11777" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Data Access Objects</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Query Builder</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Migrations</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elasticsearch.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-11778" data-toggle="collapse" data-parent="#navigation">Nhận dữ liệu từ user <b class="caret"></b></a><div id="navigation-11778" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Tạo mới Forms</a>
<a class="list-group-item" href="./guide-input-validation.html">Kiểm tra dữ liệu đầu vào (Validating Input)</a>
<a class="list-group-item" href="./guide-input-file-upload.html">File Upload</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Thu thập dữ liệu từ danh sách đầu vào (Đang phát triển)</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Lấy dữ liệu cho nhiều Models (Chưa giải quyết)</a></div>
<a class="list-group-item" href="#navigation-11779" data-toggle="collapse" data-parent="#navigation">Hiển thị dữ liệu <b class="caret"></b></a><div id="navigation-11779" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatter.html">Định dạng dữ liệu (Data Formatting)</a>
<a class="list-group-item" href="./guide-output-pagination.html">Phân trang (Pagination)</a>
<a class="list-group-item" href="./guide-output-sorting.html">Sắp xếp (Sorting)</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Cung cấp dữ liệu ra (Data Providers)</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Dữ liệu Widgets</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">làm việc với Client Scripts</a>
<a class="list-group-item" href="./guide-output-theming.html">Giao diện (Theming)</a></div>
<a class="list-group-item" href="#navigation-11780" data-toggle="collapse" data-parent="#navigation">Bảo mật (Security) <b class="caret"></b></a><div id="navigation-11780" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-security-authorization.html">Quyền (Authorization)</a>
<a class="list-group-item" href="./guide-security-passwords.html">Các thao tác xử lý với Passwords (Đang phát triển)</a>
<a class="list-group-item" href="./guide-security-auth-clients.html">Auth Clients</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Best Practices</a></div>
<a class="list-group-item" href="#navigation-11781" data-toggle="collapse" data-parent="#navigation">Bộ nhớ Cache <b class="caret"></b></a><div id="navigation-11781" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-caching-data.html">Cache dữ liệu</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Fragment Caching</a>
<a class="list-group-item" href="./guide-caching-page.html">Page Caching</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP Caching</a></div>
<a class="list-group-item" href="#navigation-11782" data-toggle="collapse" data-parent="#navigation">RESTful Web Services <b class="caret"></b></a><div id="navigation-11782" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Bắt đầu</a>
<a class="list-group-item" href="./guide-rest-resources.html">Tài nguyên (Resources)</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-rest-routing.html">Routing</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Định dạng thông điệp gửi đi (Response Formatting)</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Rate Limiting</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Phiên bản (Version)</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Error Handling</a></div>
<a class="list-group-item" href="#navigation-11783" data-toggle="collapse" data-parent="#navigation">Công cụ phát triển (Development Tools) <b class="caret"></b></a><div id="navigation-11783" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">Thanh công cụ gỡ lỗi và sửa lỗi (Debug Toolbar và Debugger)</a>
<a class="list-group-item" href="./guide-tool-gii.html">Sử dụng Gii để tạo code</a>
<a class="list-group-item" href="./guide-tool-api-doc.html">Tạo tài liệu về API </a></div>
<a class="list-group-item" href="#navigation-11784" data-toggle="collapse" data-parent="#navigation">Testing <b class="caret"></b></a><div id="navigation-11784" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Thiết lập môi trường</a>
<a class="list-group-item" href="./guide-test-unit.html">Unit Tests</a>
<a class="list-group-item" href="./guide-test-functional.html">Kiểm tra chức năng (Functional Tests)</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Acceptance Tests</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Fixtures</a></div>
<a class="list-group-item" href="#navigation-11785" data-toggle="collapse" data-parent="#navigation">Chủ đề năng cao <b class="caret"></b></a><div id="navigation-11785" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">Advanced Application Template</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Building Application from Scratch</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Giao diện dòng lệnh (Console Commands)</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Core Validators</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Quốc tế hóa (Internationalization)</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Thư (Mailing)</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Tối ưu hiệu năng ứng dụng (Performance Tuning)</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Shared Hosting Environment</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Template Engines</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Working with Third-Party Code</a></div>
<a class="list-group-item" href="#navigation-11786" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-11786" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap Widgets</a>
<a class="list-group-item" href="./guide-widget-jui.html">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-11787" data-toggle="collapse" data-parent="#navigation">Helpers <b class="caret"></b></a><div id="navigation-11787" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>フィルタ <span id="firuta"></span><a href="#firuta" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#using-filters">フィルタを使用する</a></li>
<li><a href="#creating-filters">フィルタを作成する</a></li>
<li><a href="#core-filters">コアのフィルタ</a></li></ol></div>
<p>フィルタは、<a href="guide-structure-controllers.html#actions">コントローラアクション</a> の前 および/または 後に走るオブジェクトです。
例えば、アクセスコントロールフィルタはアクションの前に走って、アクションが特定のエンドユーザだけにアクセスを許可するものであることを保証します。
また、コンテント圧縮フィルタはアクションの後に走って、レスポンスのコンテントをエンドユーザに送出する前に圧縮します。</p>
<p>一つのフィルタは、前フィルタ (アクションの <em>前</em> に適用されるフィルタのロジック) および/または 後フィルタ (アクションの <em>後</em> に適用されるロジック) から構成することが出来ます。</p>
<h2>フィルタを使用する  <span id="using-filters"></span><a href="#using-filters" class="hashlink">&para;</a></h2><p>フィルタは、本質的には特別な種類の <a href="guide-concept-behaviors.html">ビヘイビア</a> です。
したがって、フィルタを使うことは <a href="guide-concept-behaviors.html#attaching-behaviors">ビヘイビアを使う</a> ことと同じです。
下記のように、<span class="broken-link">yii\base\Controller::behaviors()</span> メソッドをオーバーライドすることによって、コントローラの中でフィルタを宣言することが出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\filters\HttpCache'</span>,
            <span class="hljs-string">'only'</span> =&gt; [<span class="hljs-string">'index'</span>, <span class="hljs-string">'view'</span>],
            <span class="hljs-string">'lastModified'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-variable">$action</span>, <span class="hljs-variable">$params</span>)</span> </span>{
                <span class="hljs-variable">$q</span> = <span class="hljs-keyword">new</span> \yii\db\Query();
                <span class="hljs-keyword">return</span> <span class="hljs-variable">$q</span>-&gt;from(<span class="hljs-string">'user'</span>)-&gt;max(<span class="hljs-string">'updated_at'</span>);
            },
        ],
    ];
}
</code></pre>
<p>デフォルトでは、コントローラクラスの中で宣言されたフィルタは、そのコントローラの <em>全て</em> のアクションに適用されます。
しかし、<span class="broken-link">yii\base\ActionFilter::only</span> プロパティを構成することによって、フィルタがどのアクションに適用されるべきかを明示的に指定することも出来ます。
上記の例では、 <code>HttpCache</code> フィルタは、<code>index</code> と <code>view</code> のアクションに対してのみ適用されています。
また、<span class="broken-link">yii\base\ActionFilter::except</span> プロパティを構成して、いくつかのアクションをフィルタされないように除外することも可能です。</p>
<p>コントローラのほかに、<a href="guide-structure-modules.html">モジュール</a> または <a href="guide-structure-applications.html">アプリケーション</a> でもフィルタを宣言することが出来ます。
そのようにした場合、<span class="broken-link">yii\base\ActionFilter::only</span> と <span class="broken-link">yii\base\ActionFilter::except</span> のプロパティを上で説明したように構成しない限り、そのフィルタは、モジュールまたはアプリケーションに属する <em>全て</em> のコントローラアクションに適用されます。</p>
<blockquote class="note"><p><strong>Note: </strong>モジュールやアプリケーションでフィルタを宣言する場合、<span class="broken-link">yii\base\ActionFilter::only</span> と <span class="broken-link">yii\base\ActionFilter::except</span> のプロパティでは、アクション ID ではなく、<a href="guide-structure-controllers.html#routes">ルート</a> を使わなければなりません。
なぜなら、モジュールやアプリケーションのスコープでは、アクション ID だけでは完全にアクションを指定することが出来ないからです。</p>
</blockquote>
<p>一つのアクションに複数のフィルタが構成されている場合、フィルタは下記で説明されている規則に従って適用されます。</p>
<ul>
<li>前フィルタ<ul>
<li>アプリケーションで宣言されたフィルタを <code>behaviors()</code> にリストされた順に適用する。</li>
<li>モジュールで宣言されたフィルタを <code>behaviors()</code> にリストされた順に適用する。</li>
<li>コントローラで宣言されたフィルタを <code>behaviors()</code> にリストされた順に適用する。</li>
<li>フィルタのどれかがアクションをキャンセルすると、そのフィルタの後のフィルタ (前フィルタと後フィルタの両方) は適用されない。</li>
</ul>
</li>
<li>前フィルタを通過したら、アクションを走らせる。</li>
<li>後フィルタ<ul>
<li>コントローラで宣言されたフィルタを <code>behaviors()</code> にリストされた逆順で適用する。</li>
<li>モジュールで宣言されたフィルタを <code>behaviors()</code> にリストされた逆順で適用する。</li>
<li>アプリケーションで宣言されたフィルタを <code>behaviors()</code> にリストされた逆順で適用する。</li>
</ul>
</li>
</ul>
<h2>フィルタを作成する  <span id="creating-filters"></span><a href="#creating-filters" class="hashlink">&para;</a></h2><p>新しいアクションフィルタを作成するためには、<span class="broken-link">yii\base\ActionFilter</span> を拡張して、<span class="broken-link">yii\base\ActionFilter::beforeAction()</span> および/または <span class="broken-link">yii\base\ActionFilter::afterAction()</span> メソッドをオーバーライドします。
前者はアクションが走る前に実行され、後者は走った後に実行されます。
<span class="broken-link">yii\base\ActionFilter::beforeAction()</span> の返り値が、アクションが実行されるべきか否かを決定します。
返り値が false である場合、このフィルタの後に続くフィルタはスキップされ、アクションは実行を中止されます。</p>
<p>次の例は、アクションの実行時間をログに記録するフィルタを示すものです。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">components</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Yii</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">base</span>\<span class="hljs-title">ActionFilter</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionTimeFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionFilter</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$_startTime</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beforeAction</span><span class="hljs-params">(<span class="hljs-variable">$action</span>)</span>
    </span>{
        <span class="hljs-variable">$this</span>-&gt;_startTime = microtime(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">parent</span>::beforeAction(<span class="hljs-variable">$action</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">afterAction</span><span class="hljs-params">(<span class="hljs-variable">$action</span>, <span class="hljs-variable">$result</span>)</span>
    </span>{
        <span class="hljs-variable">$time</span> = microtime(<span class="hljs-keyword">true</span>) - <span class="hljs-variable">$this</span>-&gt;_startTime;
        Yii::trace(<span class="hljs-string">"アクション '{$action-&gt;uniqueId}' は $time 秒を消費。"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">parent</span>::afterAction(<span class="hljs-variable">$action</span>, <span class="hljs-variable">$result</span>);
    }
}
</code></pre>
<h2>コアのフィルタ  <span id="core-filters"></span><a href="#core-filters" class="hashlink">&para;</a></h2><p>Yii はよく使われる一連のフィルタを提供しており、それらは、主として <code>yii\filters</code> 名前空間の下にあります。
以下では、それらのフィルタを簡単に紹介します。</p>
<h3><span class="broken-link">yii\filters\AccessControl</span>  <span id="access-control"></span><a href="#access-control" class="hashlink">&para;</a></h3><p>AccessControl は、一組の <span class="broken-link">yii\filters\AccessControl::rules</span> に基づいて、シンプルなアクセスコントロールを提供するものです。
具体的に言うと、アクションが実行される前に、AccessControl はリストされた規則を調べて、現在のコンテキスト変数 (例えば、ユーザの IP アドレスや、ユーザのログイン状態など) に最初に合致するものを見つけます。
そして、合致した規則によって、リクエストされたアクションの実行を許可するか拒否するかを決定します。
合致する規則がなかった場合は、アクセスは拒否されます。</p>
<p>次の例は、認証されたユーザに対しては <code>create</code> と <code>update</code> のアクションへのアクセスを許可し、その他のすべてのユーザにはこれら二つのアクションに対するアクセスを拒否する仕方を示すものです。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">AccessControl</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'access'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; AccessControl::className(),
            <span class="hljs-string">'only'</span> =&gt; [<span class="hljs-string">'create'</span>, <span class="hljs-string">'update'</span>],
            <span class="hljs-string">'rules'</span> =&gt; [
                <span class="hljs-comment">// 認証されたユーザに許可する</span>
                [
                    <span class="hljs-string">'allow'</span> =&gt; <span class="hljs-keyword">true</span>,
                    <span class="hljs-string">'roles'</span> =&gt; [<span class="hljs-string">'@'</span>],
                ],
                <span class="hljs-comment">// その他はすべてデフォルトにより拒否される</span>
            ],
        ],
    ];
}
</code></pre>
<p>アクセスコントロール一般についての詳細は <a href="guide-security-authorization.html">権限</a> の節を参照してください。</p>
<h3>認証メソッドフィルタ  <span id="auth-method-filters"></span><a href="#auth-method-filters" class="hashlink">&para;</a></h3><p>認証メソッドフィルタは、<a href="http://ja.wikipedia.org/wiki/Basic%E8%AA%8D%E8%A8%BC">HTTP Basic 認証</a>、
<a href="http://oauth.net/2/">OAuth 2</a> など、様々なメソッドを使ってユーザを認証するために使われるものです。
これらのフィルタクラスはすべて <code>yii\filters\auth</code> 名前空間の下にあります。</p>
<p>次の例は、<span class="broken-link">yii\filters\auth\HttpBasicAuth</span> の使い方を示すもので、HTTP Basic 認証に基づくアクセストークンを使ってユーザを認証しています。
これを動作させるためには、あなたの <span class="broken-link">yii\web\User::identityClass</span>
が <span class="broken-link">yii\web\IdentityInterface::findIdentityByAccessToken()</span> メソッドを実装していなければならないことに注意してください。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">auth</span>\<span class="hljs-title">HttpBasicAuth</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'basicAuth'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; HttpBasicAuth::className(),
        ],
    ];
}
</code></pre>
<p>認証メソッドフィルタは RESTful API を実装するときに使われるのが通例です。
詳細については、RESTful の <a href="guide-rest-authentication.html">認証</a> の節を参照してください。</p>
<h3><span class="broken-link">yii\filters\ContentNegotiator</span>  <span id="content-negotiator"></span><a href="#content-negotiator" class="hashlink">&para;</a></h3><p>ContentNegotiator は、レスポンス形式のネゴシエーションとアプリケーション言語のネゴシエーションをサポートします。
このフィルタは <code>GET</code> パラメータと <code>Accept</code> HTTP ヘッダを調べることによって、レスポンス形式 および/または 言語を決定しようとします。</p>
<p>次の例では、ContentNegotiator はレスポンス形式として JSON と XML をサポートし、(合衆国の)英語とドイツ語を言語としてサポートするように構成されています。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">ContentNegotiator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Response</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        [
            <span class="hljs-string">'class'</span> =&gt; ContentNegotiator::className(),
            <span class="hljs-string">'formats'</span> =&gt; [
                <span class="hljs-string">'application/json'</span> =&gt; Response::FORMAT_JSON,
                <span class="hljs-string">'application/xml'</span> =&gt; Response::FORMAT_XML,
            ],
            <span class="hljs-string">'languages'</span> =&gt; [
                <span class="hljs-string">'en-US'</span>,
                <span class="hljs-string">'de'</span>,
            ],
        ],
    ];
}
</code></pre>
<p>レスポンス形式と言語は <a href="guide-structure-applications.html#application-lifecycle">アプリケーションのライフサイクル</a> のもっと早い段階で決定される必要があることがよくあります。
このため、ContentNegotiator はフィルタの他に、<a href="guide-structure-applications.html#bootstrap">ブートストラップコンポーネント</a> としても使うことができるように設計されています。
例えば、次のように、ContentNegotiator を <a href="guide-structure-applications.html#application-configurations">アプリケーションの構成情報</a> の中で構成することが出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">ContentNegotiator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Response</span>;

[
    <span class="hljs-string">'bootstrap'</span> =&gt; [
        [
            <span class="hljs-string">'class'</span> =&gt; ContentNegotiator::className(),
            <span class="hljs-string">'formats'</span> =&gt; [
                <span class="hljs-string">'application/json'</span> =&gt; Response::FORMAT_JSON,
                <span class="hljs-string">'application/xml'</span> =&gt; Response::FORMAT_XML,
            ],
            <span class="hljs-string">'languages'</span> =&gt; [
                <span class="hljs-string">'en-US'</span>,
                <span class="hljs-string">'de'</span>,
            ],
        ],
    ],
];
</code></pre>
<blockquote class="info"><p><strong>Info: </strong>望ましいコンテントタイプと言語がリクエストから決定できない場合は、<span class="broken-link">formats</span> および <span class="broken-link">languages</span> に挙げられている最初の形式と言語が使用されます。</p>
</blockquote>
<h3><span class="broken-link">yii\filters\HttpCache</span>  <span id="http-cache"></span><a href="#http-cache" class="hashlink">&para;</a></h3><p>HttpCache は <code>Last-Modified</code> および <code>Etag</code> の HTTP ヘッダを利用して、クライアント側のキャッシュを実装するものです。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">HttpCache</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        [
            <span class="hljs-string">'class'</span> =&gt; HttpCache::className(),
            <span class="hljs-string">'only'</span> =&gt; [<span class="hljs-string">'index'</span>],
            <span class="hljs-string">'lastModified'</span> =&gt; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-variable">$action</span>, <span class="hljs-variable">$params</span>)</span> </span>{
                <span class="hljs-variable">$q</span> = <span class="hljs-keyword">new</span> \yii\db\Query();
                <span class="hljs-keyword">return</span> <span class="hljs-variable">$q</span>-&gt;from(<span class="hljs-string">'user'</span>)-&gt;max(<span class="hljs-string">'updated_at'</span>);
            },
        ],
    ];
}
</code></pre>
<p>HttpCache に関する詳細は <a href="guide-caching-http.html">HTTP キャッシュ</a> の節を参照してください。</p>
<h3><span class="broken-link">yii\filters\PageCache</span>  <span id="page-cache"></span><a href="#page-cache" class="hashlink">&para;</a></h3><p>PageCache はサーバ側におけるページ全体のキャッシュを実装するものです。
次の例では、PageCache が <code>index</code> アクションに適用されて、最大 60 秒間、または、<code>post</code> テーブルのエントリ数が変化するまでの間、ページ全体をキャッシュしています。
さらに、このページキャッシュは、選択されたアプリケーションの言語に従って、違うバージョンのページを保存するようにしています。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">PageCache</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">caching</span>\<span class="hljs-title">DbDependency</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'pageCache'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; PageCache::className(),
            <span class="hljs-string">'only'</span> =&gt; [<span class="hljs-string">'index'</span>],
            <span class="hljs-string">'duration'</span> =&gt; <span class="hljs-number">60</span>,
            <span class="hljs-string">'dependency'</span> =&gt; [
                <span class="hljs-string">'class'</span> =&gt; DbDependency::className(),
                <span class="hljs-string">'sql'</span> =&gt; <span class="hljs-string">'SELECT COUNT(*) FROM post'</span>,
            ],
            <span class="hljs-string">'variations'</span> =&gt; [
                \Yii::<span class="hljs-variable">$app</span>-&gt;language,
            ]
        ],
    ];
}
</code></pre>
<p>PageCache の使用に関する詳細は <a href="guide-caching-page.html">ページキャッシュ</a> の節を参照してください。</p>
<h3><span class="broken-link">yii\filters\RateLimiter</span>  <span id="rate-limiter"></span><a href="#rate-limiter" class="hashlink">&para;</a></h3><p>RateLimiter は <a href="http://ja.wikipedia.org/wiki/%E3%83%AA%E3%83%BC%E3%82%AD%E3%83%BC%E3%83%90%E3%82%B1%E3%83%83%E3%83%88">リーキーバケットアルゴリズム</a> に基づいてレート制限のアルゴリズムを実装するものです。
主として RESTful API を実装するときに使用されます。
このフィルタの使用に関する詳細は <a href="guide-rest-rate-limiting.html">レート制限</a> の節を参照してください。</p>
<h3><span class="broken-link">yii\filters\VerbFilter</span>  <span id="verb-filter"></span><a href="#verb-filter" class="hashlink">&para;</a></h3><p>VerbFilter は、HTTP リクエストメソッド (HTTP 動詞) がリクエストされたアクションによって許可されているかどうかをチェックするものです。
許可されていない場合は、HTTP 405 例外を投げます。
次の例では、VerbFilter が宣言されて、CRUD アクションに対して許可されるメソッドの典型的なセットを指定しています。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">VerbFilter</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'verbs'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; VerbFilter::className(),
            <span class="hljs-string">'actions'</span> =&gt; [
                <span class="hljs-string">'index'</span>  =&gt; [<span class="hljs-string">'get'</span>],
                <span class="hljs-string">'view'</span>   =&gt; [<span class="hljs-string">'get'</span>],
                <span class="hljs-string">'create'</span> =&gt; [<span class="hljs-string">'get'</span>, <span class="hljs-string">'post'</span>],
                <span class="hljs-string">'update'</span> =&gt; [<span class="hljs-string">'get'</span>, <span class="hljs-string">'put'</span>, <span class="hljs-string">'post'</span>],
                <span class="hljs-string">'delete'</span> =&gt; [<span class="hljs-string">'post'</span>, <span class="hljs-string">'delete'</span>],
            ],
        ],
    ];
}
</code></pre>
<h3><span class="broken-link">yii\filters\Cors</span>  <span id="cors"></span><a href="#cors" class="hashlink">&para;</a></h3><p>クロスオリジンリソース共有 <a href="https://developer.mozilla.org/ja/docs/HTTP_access_control">CORS</a> とは、ウェブページにおいて、さまざまなリソース (例えば、フォントや JavaScript など) を、それを生成するドメイン以外のドメインからリクエストすることを可能にするメカニズムです。
特に言えば、JavaScript の AJAX 呼出しが使用することが出来る XMLHttpRequest メカニズムです。
このような「クロスドメイン｣のリクエストは、このメカニズムに拠らなければ、同一生成元のセキュリティポリシーによって、ウェブブラウザから禁止されるはずのものです。
CORS は、ブラウザとサーバが交信して、クロスドメインのリクエストを許可するか否かを決定する方法を定義するものです。</p>
<p><span class="broken-link">yii\filters\Cors</span> は、CORS ヘッダが常に送信されることを保証するために、Authentication / Authorization のフィルタよりも前に定義されなければなりません。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">Cors</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">helpers</span>\<span class="hljs-title">ArrayHelper</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> ArrayHelper::merge([
        [
            <span class="hljs-string">'class'</span> =&gt; Cors::className(),
        ],
    ], <span class="hljs-keyword">parent</span>::behaviors());
}
</code></pre>
<p>あなたの API の <span class="broken-link">yii\rest\ActiveController</span> クラスに CORS フィルタを追加したい場合は、<a href="guide-rest-controllers.html#cors">REST コントローラ</a> の節も参照して下さい。</p>
<p>Cors のフィルタリングは <span class="broken-link">yii\filters\Cors::$cors</span> プロパティを使ってチューニングすることが出来ます。</p>
<ul>
<li><code>cors['Origin']</code>: 許可される生成元を定義するのに使われる配列。
<code>['*']</code> (すべて) または <code>['http://www.myserver.net'、'http://www.myotherserver.com']</code> などが設定可能。デフォルトは <code>['*']</code>。</li>
<li><code>cors['Access-Control-Request-Method']</code>: 許可される HTTP 動詞の配列。
たとえば、<code>['GET', 'OPTIONS', 'HEAD']</code>。デフォルトは <code>['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS']</code>。</li>
<li><code>cors['Access-Control-Request-Headers']</code>: 許可されるヘッダの配列。
全てのヘッダを意味する <code>['*']</code> または特定のヘッダを示す <code>['X-Request-With']</code> が設定可能。デフォルトは <code>['*']</code>。</li>
<li><code>cors['Access-Control-Allow-Credentials']</code>: 現在のリクエストをクレデンシャルを使ってすることが出来るかどうかを定義。
<code>true</code>、<code>false</code> または <code>null</code> (設定なし) が設定可能。デフォルトは <code>null</code>。</li>
<li><code>cors['Access-Control-Max-Age']</code>: プリフライトリクエストの寿命を定義。デフォルトは <code>86400</code>。</li>
</ul>
<p>次の例は、生成元 <code>http://www.myserver.net</code> に対する <code>GET</code>、<code>HEAD</code> および <code>OPTIONS</code> のメソッドによる CORS を許可するものです。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">Cors</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">helpers</span>\<span class="hljs-title">ArrayHelper</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> ArrayHelper::merge([
        [
            <span class="hljs-string">'class'</span> =&gt; Cors::className(),
            <span class="hljs-string">'cors'</span> =&gt; [
                <span class="hljs-string">'Origin'</span> =&gt; [<span class="hljs-string">'http://www.myserver.net'</span>],
                <span class="hljs-string">'Access-Control-Request-Method'</span> =&gt; [<span class="hljs-string">'GET'</span>, <span class="hljs-string">'HEAD'</span>, <span class="hljs-string">'OPTIONS'</span>],
            ],
        ],
    ], <span class="hljs-keyword">parent</span>::behaviors());
}
</code></pre>
<p>デフォルトのパラメータをアクション単位でオーバーライドして CORS ヘッダをチューニングすることも可能です。
例えば、<code>login</code> アクションに <code>Access-Control-Allow-Credentials</code> を追加することは、次のようにすれば出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">filters</span>\<span class="hljs-title">Cors</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">helpers</span>\<span class="hljs-title">ArrayHelper</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">behaviors</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> ArrayHelper::merge([
        [
            <span class="hljs-string">'class'</span> =&gt; Cors::className(),
            <span class="hljs-string">'cors'</span> =&gt; [
                <span class="hljs-string">'Origin'</span> =&gt; [<span class="hljs-string">'http://www.myserver.net'</span>],
                <span class="hljs-string">'Access-Control-Request-Method'</span> =&gt; [<span class="hljs-string">'GET'</span>, <span class="hljs-string">'HEAD'</span>, <span class="hljs-string">'OPTIONS'</span>],
            ],
            <span class="hljs-string">'actions'</span> =&gt; [
                <span class="hljs-string">'login'</span> =&gt; [
                    <span class="hljs-string">'Access-Control-Allow-Credentials'</span> =&gt; <span class="hljs-keyword">true</span>,
                ]
            ]
        ],
    ], <span class="hljs-keyword">parent</span>::behaviors());
}
</code></pre>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Tue, 27 Dec 2016 22:28:43 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
