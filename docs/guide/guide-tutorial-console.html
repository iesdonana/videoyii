<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/90d046f2/css/bootstrap.css" rel="stylesheet">
<link href="./assets/c6368d94/solarized_light.css" rel="stylesheet">
<link href="./assets/9f5cdd92/style.css" rel="stylesheet">
<script src="./assets/a6e53573/jquery.js"></script>
<script src="./assets/90d046f2/js/bootstrap.js"></script>
<script src="./assets/218ce2e5/jssearch.js"></script>    <title>Giao diện dòng lệnh (Console Commands) - Chủ đề năng cao - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w12418" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w12418-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./guide-index.html">The Definitive Guide to Yii 2.0</a></div><div id="w12418-collapse" class="collapse navbar-collapse"><ul id="w12419" class="navbar-nav nav"><li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-12402" data-toggle="collapse" data-parent="#navigation">Giới thiệu <b class="caret"></b></a><div id="navigation-12402" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">Về Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Nâng cấp lên từ phiên bản 1.1</a></div>
<a class="list-group-item" href="#navigation-12403" data-toggle="collapse" data-parent="#navigation">Bắt đầu <b class="caret"></b></a><div id="navigation-12403" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Cài đặt Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Thực hiện chạy ứng dụng</a>
<a class="list-group-item" href="./guide-start-hello.html">Viết lời chào đầu tiên</a>
<a class="list-group-item" href="./guide-start-forms.html">Làm việc với Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">Làm việc với Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">Sử dụng Gii để sinh code</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Mức cao hơn</a></div>
<a class="list-group-item" href="#navigation-12404" data-toggle="collapse" data-parent="#navigation">Kiến trúc ứng dụng (Application Structure) <b class="caret"></b></a><div id="navigation-12404" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">Tổng quan về kiến trúc ứng dụng</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Mục Scripts</a>
<a class="list-group-item" href="./guide-structure-applications.html">Ứng dụng (Applications)</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Thành phần ứng dụng</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-structure-models.html">Models</a>
<a class="list-group-item" href="./guide-structure-views.html">Views</a>
<a class="list-group-item" href="./guide-structure-modules.html">Modules</a>
<a class="list-group-item" href="./guide-structure-filters.html">Bộ lọc (Filters)</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Widgets</a>
<a class="list-group-item" href="./guide-structure-assets.html">Assets</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Phần mở rộng (Extensions)</a></div>
<a class="list-group-item" href="#navigation-12405" data-toggle="collapse" data-parent="#navigation">Yêu cầu xử lý (Handling Requests) <b class="caret"></b></a><div id="navigation-12405" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Routing và URL Creation</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Yêu cầu (Requests)</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Responses</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions và Cookies</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Xử lý lỗi (Handling Error)</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Logging</a></div>
<a class="list-group-item" href="#navigation-12406" data-toggle="collapse" data-parent="#navigation">Các khái niệm chính <b class="caret"></b></a><div id="navigation-12406" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Thành phần (Components)</a>
<a class="list-group-item" href="./guide-concept-properties.html">Thuộc tính (Properties)</a>
<a class="list-group-item" href="./guide-concept-events.html">Sự kiện (Events)</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Hành vi (Behaviors)</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Cấu hình (Configurations)</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Bí danh (Aliases)</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Lớp tự động nạp (Autoloading)</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-12407" data-toggle="collapse" data-parent="#navigation">Làm việc với Databases <b class="caret"></b></a><div id="navigation-12407" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Data Access Objects</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Query Builder</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Migrations</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elasticsearch.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-12408" data-toggle="collapse" data-parent="#navigation">Nhận dữ liệu từ user <b class="caret"></b></a><div id="navigation-12408" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Tạo mới Forms</a>
<a class="list-group-item" href="./guide-input-validation.html">Kiểm tra dữ liệu đầu vào (Validating Input)</a>
<a class="list-group-item" href="./guide-input-file-upload.html">File Upload</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Thu thập dữ liệu từ danh sách đầu vào (Đang phát triển)</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Lấy dữ liệu cho nhiều Models (Chưa giải quyết)</a></div>
<a class="list-group-item" href="#navigation-12409" data-toggle="collapse" data-parent="#navigation">Hiển thị dữ liệu <b class="caret"></b></a><div id="navigation-12409" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatter.html">Định dạng dữ liệu (Data Formatting)</a>
<a class="list-group-item" href="./guide-output-pagination.html">Phân trang (Pagination)</a>
<a class="list-group-item" href="./guide-output-sorting.html">Sắp xếp (Sorting)</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Cung cấp dữ liệu ra (Data Providers)</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Dữ liệu Widgets</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">làm việc với Client Scripts</a>
<a class="list-group-item" href="./guide-output-theming.html">Giao diện (Theming)</a></div>
<a class="list-group-item" href="#navigation-12410" data-toggle="collapse" data-parent="#navigation">Bảo mật (Security) <b class="caret"></b></a><div id="navigation-12410" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-security-authorization.html">Quyền (Authorization)</a>
<a class="list-group-item" href="./guide-security-passwords.html">Các thao tác xử lý với Passwords (Đang phát triển)</a>
<a class="list-group-item" href="./guide-security-auth-clients.html">Auth Clients</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Best Practices</a></div>
<a class="list-group-item" href="#navigation-12411" data-toggle="collapse" data-parent="#navigation">Bộ nhớ Cache <b class="caret"></b></a><div id="navigation-12411" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-caching-data.html">Cache dữ liệu</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Fragment Caching</a>
<a class="list-group-item" href="./guide-caching-page.html">Page Caching</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP Caching</a></div>
<a class="list-group-item" href="#navigation-12412" data-toggle="collapse" data-parent="#navigation">RESTful Web Services <b class="caret"></b></a><div id="navigation-12412" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Bắt đầu</a>
<a class="list-group-item" href="./guide-rest-resources.html">Tài nguyên (Resources)</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-rest-routing.html">Routing</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Định dạng thông điệp gửi đi (Response Formatting)</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Rate Limiting</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Phiên bản (Version)</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Error Handling</a></div>
<a class="list-group-item" href="#navigation-12413" data-toggle="collapse" data-parent="#navigation">Công cụ phát triển (Development Tools) <b class="caret"></b></a><div id="navigation-12413" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">Thanh công cụ gỡ lỗi và sửa lỗi (Debug Toolbar và Debugger)</a>
<a class="list-group-item" href="./guide-tool-gii.html">Sử dụng Gii để tạo code</a>
<a class="list-group-item" href="./guide-tool-api-doc.html">Tạo tài liệu về API </a></div>
<a class="list-group-item" href="#navigation-12414" data-toggle="collapse" data-parent="#navigation">Testing <b class="caret"></b></a><div id="navigation-12414" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Thiết lập môi trường</a>
<a class="list-group-item" href="./guide-test-unit.html">Unit Tests</a>
<a class="list-group-item" href="./guide-test-functional.html">Kiểm tra chức năng (Functional Tests)</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Acceptance Tests</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Fixtures</a></div>
<a class="list-group-item active" href="#navigation-12415" data-toggle="collapse" data-parent="#navigation">Chủ đề năng cao <b class="caret"></b></a><div id="navigation-12415" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">Advanced Application Template</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Building Application from Scratch</a>
<a class="list-group-item active" href="./guide-tutorial-console.html">Giao diện dòng lệnh (Console Commands)</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Core Validators</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Quốc tế hóa (Internationalization)</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Thư (Mailing)</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Tối ưu hiệu năng ứng dụng (Performance Tuning)</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Shared Hosting Environment</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Template Engines</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Working with Third-Party Code</a></div>
<a class="list-group-item" href="#navigation-12416" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-12416" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap Widgets</a>
<a class="list-group-item" href="./guide-widget-jui.html">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-12417" data-toggle="collapse" data-parent="#navigation">Helpers <b class="caret"></b></a><div id="navigation-12417" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>コンソールアプリケーション <span id="konsoruapurikeshon"></span><a href="#konsoruapurikeshon" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#usage">使用方法</a></li>
<li><a href="#entry-script">エントリスクリプト</a></li>
<li><a href="#configuration">構成情報</a></li>
<li><a href="#create-command">あなた自身のコンソールコマンドを作成する</a></li></ol></div>
<p>ウェブアプリケーションを構築するための豊富な機能に加えて、Yii はコンソールアプリケーションのためのフル装備のサポートを持っています。
コンソールアプリケーションは、主として、ウェブサイトのために実行する必要のあるバックグラウンドのタスクやメンテナンスのタスクを作成するために使われるものです。</p>
<p>コンソールアプリケーションの構造は Yii のウェブアプリケーションのそれと非常に良く似ています。
コンソールアプリケーションは一つまたは複数の <span class="broken-link">yii\console\Controller</span> クラスから構成されます。
コントローラはコンソール環境ではしばしば「コマンド」と呼ばれます。
また、各コントローラは、ウェブのコントローラと全く同じように、一つまたは複数のアクションを持つことが出来ます。</p>
<p>プロジェクトテンプレートは、両方とも、既にコンソールアプリケーションを持っています。
レポジトリのベースディレクトリにある <code>yii</code> スクリプトを呼び出すことによって、コンソールアプリケーションを実行することが出来ます。
このスクリプトは、何もパラメータを追加せずに実行すると、利用できるコマンドの一覧を表示します。</p>
<p><img src="images/tutorial-console-help.png" alt="./yii コマンドを実行してヘルプを表示する" /></p>
<p>スクリーンショットに表示されているように、デフォルトで利用できる一連のコマンドが Yii によって既に定義されています。</p>
<ul>
<li><span class="broken-link">yii\console\controllers\AssetController</span> - JavaScript と CSS ファイルを結合して圧縮することが出来ます。
このコマンドについては、<a href="guide-structure-assets.html#using-the-asset-command">アセットの節</a> でさらに学習することが出来ます。</li>
<li><span class="broken-link">yii\console\controllers\CacheController</span> - アプリケーションのキャッシュをフラッシュすることが出来ます。</li>
<li><span class="broken-link">yii\console\controllers\FixtureController</span> - テストのために、フィクスチャデータのロードとアンロードを管理します。
このコマンドについては <a href="guide-test-fixtures.html#managing-fixtures">テストのフィクスチャの節</a> で詳細に説明されています。</li>
<li><span class="broken-link">yii\console\controllers\HelpController</span> - コンソールコマンドについてのヘルプ情報を提供します。
これがデフォルトのコマンドであり、上のスクリーンショットで見た出力を表示するものです。</li>
<li><span class="broken-link">yii\console\controllers\MessageController</span> - ソースファイルから翻訳すべきメッセージを抽出します。
このコマンドについてさらに学習するためには、<a href="guide-tutorial-i18n.html#message-command">国際化の節</a> を参照してください。</li>
<li><span class="broken-link">yii\console\controllers\MigrateController</span> - アプリケーションのマイグレーションを管理します。
データベースのマイグレーションについては、<a href="guide-db-migrations.html">データベースのマイグレーションの節</a> で詳しく説明されています。</li>
<li><span class="broken-link">yii\console\controllers\ServeController</span> - PHP の内蔵ウェブサーバを走らせることが出来ます。</li>
</ul>
<h2>使用方法  <span id="usage"></span><a href="#usage" class="hashlink">&para;</a></h2><p>コンソールのコントローラアクションは次の構文を使って実行します。</p>
<pre><code class="hljs apache"><span class="hljs-keyword">yii</span> &lt;route&gt;<span class="hljs-sqbracket"> [--option1=value1 --option2=value2 ... argument1 argument2 ...]</span>
</code></pre>
<p>上記において、<code>&lt;route&gt;</code> はコントローラアクションへのルートを示すものです。
オプション (options) はクラスのプロパティに代入され、引数 (arguments) はアクションメソッドのパラメータとなります。</p>
<p>例えば、<span class="broken-link">yii\console\controllers\MigrateController::$migrationTable</span> として <code>migrations</code> を指定し、マイグレーションの上限を 5 と指定して <span class="broken-link">yii\console\controllers\MigrateController::actionUp()</span> を呼び出すためには、次のようにします。</p>
<pre><code class="hljs nginx"><span class="hljs-title">yii</span> migrate/up <span class="hljs-number">5</span> --migrationTable=migrations
</code></pre>
<blockquote class="note"><p><strong>Note: </strong>コンソールで <code>*</code> を使う場合は、<code>"*"</code> として引用符号で囲むことを忘れないでください。
これは、<code>*</code> をカレントディレクトリの全てのファイル名に置き換えられるシェルのグロブとして実行してしまうことを避けるためです。</p>
</blockquote>
<h2>エントリスクリプト  <span id="entry-script"></span><a href="#entry-script" class="hashlink">&para;</a></h2><p>コンソールアプリケーションのエントリスクリプトは、ウェブアプリケーションで使用されるブートストラップファイル <code>index.php</code> に相当するものです。
コンソールのエントリスクリプトは通常は <code>yii</code> と呼ばれるもので、アプリケーションのルートディレクトリに配置されています。
それは次のようなコードを含んでいます。</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">#!/usr/bin/env php</span>
<span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-comment">/**
 * Yii console bootstrap file.
 */</span>

defined(<span class="hljs-string">'YII_DEBUG'</span>) <span class="hljs-keyword">or</span> define(<span class="hljs-string">'YII_DEBUG'</span>, <span class="hljs-keyword">true</span>);

<span class="hljs-keyword">require</span>(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/vendor/autoload.php'</span>);
<span class="hljs-keyword">require</span>(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/vendor/yiisoft/yii2/Yii.php'</span>);

<span class="hljs-variable">$config</span> = <span class="hljs-keyword">require</span>(<span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/config/console.php'</span>);

<span class="hljs-variable">$application</span> = <span class="hljs-keyword">new</span> yii\console\Application(<span class="hljs-variable">$config</span>);
<span class="hljs-variable">$exitCode</span> = <span class="hljs-variable">$application</span>-&gt;run();
<span class="hljs-keyword">exit</span>(<span class="hljs-variable">$exitCode</span>);
</code></pre>
<p>このスクリプトはアプリケーションの一部として生成されるものです。
あなたの必要を満たすように、自由に編集して構いません。
エラー発生時にスタックトレースを見たくない、または、全体のパフォーマンスを上げたい、という場合は、<code>YII_DEBUG</code> 定数を <code>false</code> に設定することが出来ます。
ベーシックプロジェクトテンプレートでも、アドバンストプロジェクトテンプレートでも、コンソールアプリケーションのエントリスクリプトは、開発者に優しい環境を提供するために、デフォルトでデバッグを有効にしています。</p>
<h2>構成情報  <span id="configuration"></span><a href="#configuration" class="hashlink">&para;</a></h2><p>上記のコードで見るように、コンソールアプリケーションは、<code>console.php</code> という名前のそれ自身の構成情報ファイルを使用します。
このファイルの中で、さまざまな <a href="guide-structure-application-components.html">アプリケーションコンポーネント</a>、取り分け、コンソールアプリケーションのためのプロパティを構成しなければなりません。</p>
<p>ウェブアプリケーションとコンソールアプリケーションが構成情報のパラメータと値を数多く共有する場合は、共通の部分を独立したファイルに移動して、そのファイルを両方のアプリケーション (ウェブとコンソール) の構成情報にインクルードすることを検討しても良いでしょう。
その例を「アドバンスト」プロジェクトテンプレートの中で見ることが出来ます。</p>
<blockquote class="tip"><p><strong>Tip: </strong>場合によっては、エントリスクリプトで指定されているのとは異なるアプリケーション構成情報を使ってコンソールコマンドを実行したいことがあります。
例えば、<code>yii migrate</code> コマンドを使ってテストのデータベースをアップグレードするとき、データベースが個々のテストスイートの中で構成されているような場合です。
構成情報を動的に変更するためには、コマンドを実行するときに <code>appconfig</code> オプションを使ってカスタムの構成情報ファイルを指定するだけで大丈夫です。</p>
<pre><code class="hljs nginx"><span class="hljs-title">yii</span> &lt;route&gt; --appconfig=path/to/config.php ...
</code></pre>
</blockquote>
<h2>あなた自身のコンソールコマンドを作成する  <span id="create-command"></span><a href="#create-command" class="hashlink">&para;</a></h2><h3>コンソールのコントローラとアクション <span id="konsorunokontororatoakushon"></span><a href="#konsorunokontororatoakushon" class="hashlink">&para;</a></h3><p>コンソールコマンドは、<span class="broken-link">yii\console\Controller</span> を拡張するコントローラクラスとして定義することが出来ます。
コントローラクラスの中で、コントローラのサブコマンドに対応する一つまたは複数のアクションを定義します。
各アクションの中で、その特定のサブコマンドのための適切なタスクを実装するコードを書きます。</p>
<p>コマンドを実行するときは、コントローラのアクションに対するルートを指定する必要があります。
例えば、ルート <code>migrate/create</code> は、<span class="broken-link">yii\console\controllers\MigrateController::actionCreate()</span> アクションメソッドに対応するサブコマンドを呼び出します。
実行時に提供されたルートにアクション ID が含まれない場合は、(ウェブのコントローラの場合と同じように) デフォルトのアクションが実行されます。</p>
<h3>オプション <span id="opushon"></span><a href="#opushon" class="hashlink">&para;</a></h3><p><span class="broken-link">yii\console\Controller::options()</span> メソッドをオーバーライドすることによって、コンソールコマンド (controller/actionID) で利用できるオプションを指定することが出来ます。
このメソッドはコントローラクラスのパブリックなプロパティのリストを返さなければなりません。
コマンドを実行するときは、<code>--OptionName=OptionValue</code> という構文を使ってオプションの値を指定することが出来ます。これはコントローラクラスの <code>OptionName</code> プロパティに <code>OptionValue</code> を割り当てるものです。</p>
<p>オプションのデフォルト値が配列型である場合、実行時にこのオプションをセットすると、オプションの値は、入力文字列をカンマで分離することによって、配列に変換されます。</p>
<h3>オプションのエイリアス <span id="opushonnoeiriasu"></span><a href="#opushonnoeiriasu" class="hashlink">&para;</a></h3><p>バージョン 2.0.8 以降、コンソールコマンドは、オプションにエイリアスを追加するための <span class="broken-link">yii\console\Controller::optionAliases()</span> メソッドを提供しています。</p>
<p>エイリアスを定義するためには、コントローラで <span class="broken-link">yii\console\Controller::optionAliases()</span> をオーバーライドします。
例えば、</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">commands</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">console</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$message</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">options</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [<span class="hljs-string">'message'</span>];
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">optionAliases</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [<span class="hljs-string">'m'</span> =&gt; <span class="hljs-string">'message'</span>];
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionIndex</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$this</span>-&gt;message . <span class="hljs-string">"\n"</span>;
    }
}
</code></pre>
<p>これで、次の構文を使ってコマンドを走らせることが出来るようになります。</p>
<pre><code class="hljs ">./yii hello -m=hello
</code></pre>
<h3>引数 <span id="yin-shu"></span><a href="#yin-shu" class="hashlink">&para;</a></h3><p>オプションに加えてに、コマンドは引数を取ることも出来ます。
引数は、リクエストされたサブコマンドに対応するアクションメソッドへのパラメータとして渡されます。
最初の引数は最初のパラメータに対応し、二番目の引数は二番目のパラメータに対応し、以下同様です。
コマンドが呼び出されたときに十分な数の引数が提供されなかったときは、対応するパラメータは、定義されていれば、宣言されているデフォルト値をとります。
デフォルト値が設定されておらず、実行時に値が提供されなかった場合は、コマンドはエラーで終了します。</p>
<p><code>array</code> タイプヒントを使って、引数が配列として扱われるべきことを示すことが出来ます。
配列は入力文字列をカンマで分割することによって生成されます。</p>
<p>次に引数を宣言する方法を示す例を挙げます。</p>
<pre><code class="hljs php language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleController</span> <span class="hljs-keyword">extends</span> \<span class="hljs-title">yii</span>\<span class="hljs-title">console</span>\<span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-comment">// コマンド "yii example/create test" は "actionCreate('test')" を呼び出す</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionCreate</span><span class="hljs-params">(<span class="hljs-variable">$name</span>)</span> </span>{ ... }

    <span class="hljs-comment">// コマンド "yii example/index city" は "actionIndex('city', 'name')" を呼び出す</span>
    <span class="hljs-comment">// コマンド "yii example/index city id" は call "actionIndex('city', 'id')" を呼び出す</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionIndex</span><span class="hljs-params">(<span class="hljs-variable">$category</span>, <span class="hljs-variable">$order</span> = <span class="hljs-string">'name'</span>)</span> </span>{ ... }

    <span class="hljs-comment">// コマンド "yii example/add test" は "actionAdd(['test'])" を呼び出す</span>
    <span class="hljs-comment">// コマンド "yii example/add test1,test2" は "actionAdd(['test1', 'test2'])" を呼び出す</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionAdd</span><span class="hljs-params">(array <span class="hljs-variable">$name</span>)</span> </span>{ ... }
}
</code></pre>
<h3>終了コード <span id="zhong-lekodo"></span><a href="#zhong-lekodo" class="hashlink">&para;</a></h3><p>終了コードを使うことはコンソールアプリケーション開発のベストプラクティスです。
コマンドは何も問題が無かったことを示すために <code>0</code> を返すのが慣例です。
コマンドが 1 以上の値を返したときは、何かエラーを示唆するものとみなされます。
返される数値がエラーコードであり、それによってエラーに関する詳細を見出すことが出来る場合もあります。
例えば、<code>1</code> は一般的な未知のエラーを示すものとし、<code>2</code> 以上の全てのコードは特定のエラー、例えば、入力エラー、ファイルが見つからない、等々を示すものとすることが出来ます。</p>
<p>コンソールコマンドに終了コードを返させるためには、単にコントローラのアクションメソッドで整数を返すようにします。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionIndex</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-comment">/* 何らかの問題が発生 */</span>) {
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"A problem occurred!\n"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    <span class="hljs-comment">// 何かをする</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>いくつか使用できる事前定義された定数があります。</p>
<ul>
<li><span class="broken-link">yii\console\Controller::EXIT_CODE_NORMAL</span> - 値は <code>0</code></li>
<li><span class="broken-link">yii\console\Controller::EXIT_CODE_ERROR</span> - 値は <code>1</code></li>
</ul>
<p>もっと多くのエラーコードの種類がある場合は、コントローラで意味のある定数を定義するのが良いプラクティスです。</p>
<h3>書式設定と色 <span id="shu-shi-she-dingto-se"></span><a href="#shu-shi-she-dingto-se" class="hashlink">&para;</a></h3><p>Yii のコンソールコマンドは出力の書式設定をサポートしています。
これは、コマンドを走らせている端末がサポートしていない場合は、自動的に書式設定の無い出力にグレードダウンされます。</p>
<p>書式設定された文字列を出力することは簡単です。
ボールドのテキストを出力するには、次のようにします。</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$this</span>-&gt;stdout(<span class="hljs-string">"Hello?\n"</span>, Console::BOLD);
</code></pre>
<p>複数のスタイルを動的に結合して文字列を構成する必要がある場合は、<span class="broken-link">yii\helpers\Console::ansiFormat()</span> を使うほうが良いでしょう。</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$name</span> = <span class="hljs-variable">$this</span>-&gt;ansiFormat(<span class="hljs-string">'Alex'</span>, Console::FG_YELLOW);
<span class="hljs-keyword">echo</span> <span class="hljs-string">"Hello, my name is $name."</span>;
</code></pre>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Tue, 27 Dec 2016 22:28:43 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
