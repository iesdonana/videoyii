<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/90d046f2/css/bootstrap.css" rel="stylesheet">
<link href="./assets/c6368d94/solarized_light.css" rel="stylesheet">
<link href="./assets/9f5cdd92/style.css" rel="stylesheet">
<script src="./assets/a6e53573/jquery.js"></script>
<script src="./assets/90d046f2/js/bootstrap.js"></script>
<script src="./assets/218ce2e5/jssearch.js"></script>    <title>Views - Kiến trúc ứng dụng (Application Structure) - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w11698" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w11698-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./guide-index.html">The Definitive Guide to Yii 2.0</a></div><div id="w11698-collapse" class="collapse navbar-collapse"><ul id="w11699" class="navbar-nav nav"><li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-11682" data-toggle="collapse" data-parent="#navigation">Giới thiệu <b class="caret"></b></a><div id="navigation-11682" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">Về Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Nâng cấp lên từ phiên bản 1.1</a></div>
<a class="list-group-item" href="#navigation-11683" data-toggle="collapse" data-parent="#navigation">Bắt đầu <b class="caret"></b></a><div id="navigation-11683" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Cài đặt Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Thực hiện chạy ứng dụng</a>
<a class="list-group-item" href="./guide-start-hello.html">Viết lời chào đầu tiên</a>
<a class="list-group-item" href="./guide-start-forms.html">Làm việc với Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">Làm việc với Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">Sử dụng Gii để sinh code</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Mức cao hơn</a></div>
<a class="list-group-item active" href="#navigation-11684" data-toggle="collapse" data-parent="#navigation">Kiến trúc ứng dụng (Application Structure) <b class="caret"></b></a><div id="navigation-11684" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-structure-overview.html">Tổng quan về kiến trúc ứng dụng</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Mục Scripts</a>
<a class="list-group-item" href="./guide-structure-applications.html">Ứng dụng (Applications)</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Thành phần ứng dụng</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-structure-models.html">Models</a>
<a class="list-group-item active" href="./guide-structure-views.html">Views</a>
<a class="list-group-item" href="./guide-structure-modules.html">Modules</a>
<a class="list-group-item" href="./guide-structure-filters.html">Bộ lọc (Filters)</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Widgets</a>
<a class="list-group-item" href="./guide-structure-assets.html">Assets</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Phần mở rộng (Extensions)</a></div>
<a class="list-group-item" href="#navigation-11685" data-toggle="collapse" data-parent="#navigation">Yêu cầu xử lý (Handling Requests) <b class="caret"></b></a><div id="navigation-11685" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Routing và URL Creation</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Yêu cầu (Requests)</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Responses</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions và Cookies</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Xử lý lỗi (Handling Error)</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Logging</a></div>
<a class="list-group-item" href="#navigation-11686" data-toggle="collapse" data-parent="#navigation">Các khái niệm chính <b class="caret"></b></a><div id="navigation-11686" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Thành phần (Components)</a>
<a class="list-group-item" href="./guide-concept-properties.html">Thuộc tính (Properties)</a>
<a class="list-group-item" href="./guide-concept-events.html">Sự kiện (Events)</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Hành vi (Behaviors)</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Cấu hình (Configurations)</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Bí danh (Aliases)</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Lớp tự động nạp (Autoloading)</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-11687" data-toggle="collapse" data-parent="#navigation">Làm việc với Databases <b class="caret"></b></a><div id="navigation-11687" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Data Access Objects</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Query Builder</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Migrations</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elasticsearch.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-11688" data-toggle="collapse" data-parent="#navigation">Nhận dữ liệu từ user <b class="caret"></b></a><div id="navigation-11688" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Tạo mới Forms</a>
<a class="list-group-item" href="./guide-input-validation.html">Kiểm tra dữ liệu đầu vào (Validating Input)</a>
<a class="list-group-item" href="./guide-input-file-upload.html">File Upload</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Thu thập dữ liệu từ danh sách đầu vào (Đang phát triển)</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Lấy dữ liệu cho nhiều Models (Chưa giải quyết)</a></div>
<a class="list-group-item" href="#navigation-11689" data-toggle="collapse" data-parent="#navigation">Hiển thị dữ liệu <b class="caret"></b></a><div id="navigation-11689" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatter.html">Định dạng dữ liệu (Data Formatting)</a>
<a class="list-group-item" href="./guide-output-pagination.html">Phân trang (Pagination)</a>
<a class="list-group-item" href="./guide-output-sorting.html">Sắp xếp (Sorting)</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Cung cấp dữ liệu ra (Data Providers)</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Dữ liệu Widgets</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">làm việc với Client Scripts</a>
<a class="list-group-item" href="./guide-output-theming.html">Giao diện (Theming)</a></div>
<a class="list-group-item" href="#navigation-11690" data-toggle="collapse" data-parent="#navigation">Bảo mật (Security) <b class="caret"></b></a><div id="navigation-11690" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-security-authorization.html">Quyền (Authorization)</a>
<a class="list-group-item" href="./guide-security-passwords.html">Các thao tác xử lý với Passwords (Đang phát triển)</a>
<a class="list-group-item" href="./guide-security-auth-clients.html">Auth Clients</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Best Practices</a></div>
<a class="list-group-item" href="#navigation-11691" data-toggle="collapse" data-parent="#navigation">Bộ nhớ Cache <b class="caret"></b></a><div id="navigation-11691" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-caching-data.html">Cache dữ liệu</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Fragment Caching</a>
<a class="list-group-item" href="./guide-caching-page.html">Page Caching</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP Caching</a></div>
<a class="list-group-item" href="#navigation-11692" data-toggle="collapse" data-parent="#navigation">RESTful Web Services <b class="caret"></b></a><div id="navigation-11692" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Bắt đầu</a>
<a class="list-group-item" href="./guide-rest-resources.html">Tài nguyên (Resources)</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-rest-routing.html">Routing</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Định dạng thông điệp gửi đi (Response Formatting)</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Rate Limiting</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Phiên bản (Version)</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Error Handling</a></div>
<a class="list-group-item" href="#navigation-11693" data-toggle="collapse" data-parent="#navigation">Công cụ phát triển (Development Tools) <b class="caret"></b></a><div id="navigation-11693" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">Thanh công cụ gỡ lỗi và sửa lỗi (Debug Toolbar và Debugger)</a>
<a class="list-group-item" href="./guide-tool-gii.html">Sử dụng Gii để tạo code</a>
<a class="list-group-item" href="./guide-tool-api-doc.html">Tạo tài liệu về API </a></div>
<a class="list-group-item" href="#navigation-11694" data-toggle="collapse" data-parent="#navigation">Testing <b class="caret"></b></a><div id="navigation-11694" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Thiết lập môi trường</a>
<a class="list-group-item" href="./guide-test-unit.html">Unit Tests</a>
<a class="list-group-item" href="./guide-test-functional.html">Kiểm tra chức năng (Functional Tests)</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Acceptance Tests</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Fixtures</a></div>
<a class="list-group-item" href="#navigation-11695" data-toggle="collapse" data-parent="#navigation">Chủ đề năng cao <b class="caret"></b></a><div id="navigation-11695" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">Advanced Application Template</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Building Application from Scratch</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Giao diện dòng lệnh (Console Commands)</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Core Validators</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Quốc tế hóa (Internationalization)</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Thư (Mailing)</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Tối ưu hiệu năng ứng dụng (Performance Tuning)</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Shared Hosting Environment</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Template Engines</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Working with Third-Party Code</a></div>
<a class="list-group-item" href="#navigation-11696" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-11696" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap Widgets</a>
<a class="list-group-item" href="./guide-widget-jui.html">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-11697" data-toggle="collapse" data-parent="#navigation">Helpers <b class="caret"></b></a><div id="navigation-11697" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>ビュー <span id="byu"></span><a href="#byu" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#creating-views">ビューを作成する</a></li>
<li><a href="#rendering-views">ビューをレンダリングする</a></li>
<li><a href="#layouts">レイアウト</a></li>
<li><a href="#using-view-components">ビューコンポーネントを使う</a></li>
<li><a href="#view-events">ビューのイベント</a></li>
<li><a href="#rendering-static-pages">静的なページをレンダリングする</a></li>
<li><a href="#best-practices">ベストプラクティス</a></li></ol></div>
<p>ビューは <a href="http://ja.wikipedia.org/wiki/Model_View_Controller">MVC</a> アーキテクチャの一部を成すものです。
ビューはエンドユーザにデータを表示することに責任を持つコードです。
ウェブアプリケーションにおいては、ビューは、通常、主として HTML コードと表示目的の PHP コードを含む PHP スクリプトファイルである、<em>ビューテンプレート</em> の形式で作成されます。
そして、ビューテンプレートを管理する <span class="broken-link">yii\web\View</span> <a href="guide-structure-application-components.html">アプリケーションコンポーネント</a> が、ビューの構築とレンダリングを助けるためによく使われるメソッドを提供します。
なお、簡潔さを重視して、ビューテンプレートまたはビューテンプレートファイルを単にビューと呼ぶことがよくあります。</p>
<h2>ビューを作成する  <span id="creating-views"></span><a href="#creating-views" class="hashlink">&para;</a></h2><p>前述のように、ビューは HTML と PHP コードが混ざった単なる PHP スクリプトです。
次に示すのは、ログインフォームを表示するビューです。
ご覧のように、PHP コードがタイトルやフォームなど動的なコンテントを生成するのに使われ、HTML コードがそれらを編成して表示可能な HTML ページを作っています。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">helpers</span>\<span class="hljs-title">Html</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">widgets</span>\<span class="hljs-title">ActiveForm</span>;

<span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $this yii\web\View */</span>
<span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $form yii\widgets\ActiveForm */</span>
<span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $model app\models\LoginForm */</span>

<span class="hljs-variable">$this</span>-&gt;title = <span class="hljs-string">'ログイン'</span>;
<span class="hljs-preprocessor">?&gt;</span>
&lt;h1&gt;<span class="hljs-preprocessor">&lt;?</span>= Html::encode(<span class="hljs-variable">$this</span>-&gt;title) <span class="hljs-preprocessor">?&gt;</span>&lt;/h1&gt;

&lt;p&gt;次の項目を入力してログインしてください:&lt;/p&gt;

<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$form</span> = ActiveForm::begin(); <span class="hljs-preprocessor">?&gt;</span>
    <span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$form</span>-&gt;field(<span class="hljs-variable">$model</span>, <span class="hljs-string">'username'</span>) <span class="hljs-preprocessor">?&gt;</span>
    <span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$form</span>-&gt;field(<span class="hljs-variable">$model</span>, <span class="hljs-string">'password'</span>)-&gt;passwordInput() <span class="hljs-preprocessor">?&gt;</span>
    <span class="hljs-preprocessor">&lt;?</span>= Html::submitButton(<span class="hljs-string">'ログイン'</span>) <span class="hljs-preprocessor">?&gt;</span>
<span class="hljs-preprocessor">&lt;?php</span> ActiveForm::end(); <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>ビューの中では、このビューテンプレートを管理しレンダリングしている <span class="broken-link">yii\web\View</span> を参照する <code>$this</code> にアクセスすることが出来ます。</p>
<p><code>$this</code> 以外に、上記の例の <code>$model</code> のように、事前に定義される変数をビューの中に置くことが出来ます。
このような変数は、<a href="#rendering-views">ビューのレンダリング</a> をトリガする <a href="guide-structure-controllers.html">コントローラ</a> などのオブジェクトによってビューに <em>プッシュ</em> されるデータを表します。</p>
<blockquote class="tip"><p><strong>Tip: </strong>上の例では、事前に定義される変数は、IDE に認識されるように、ビューの先頭のコメントブロックの中にリストされています。
  これは、ビューにドキュメントを付けるのにも良い方法です。</p>
</blockquote>
<h3>セキュリティ  <span id="security"></span><a href="#security" class="hashlink">&para;</a></h3><p>HTML ページを生成するビューを作成するときは、エンドユーザから受け取るデータを表示する前にエンコード および/または フィルタすることが重要です。
そうしなければ、あなたのアプリケーションは <a href="http://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%AD%E3%82%B9%E3%82%B5%E3%82%A4%E3%83%88%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">クロスサイトスクリプティング</a> 攻撃をこうむるおそれがあります。</p>
<p>平文テキストを表示するためには、まず <span class="broken-link">yii\helpers\Html::encode()</span> を呼んでエンコードします。
例えば、次のコードはユーザの名前を表示する前にエンコードしています。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">helpers</span>\<span class="hljs-title">Html</span>;
<span class="hljs-preprocessor">?&gt;</span>

&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>="<span class="hljs-title">username</span>"&gt;
    &lt;?= <span class="hljs-title">Html</span>::<span class="hljs-title">encode</span>($<span class="hljs-title">user</span>-&gt;<span class="hljs-title">name</span>) ?&gt;
&lt;/<span class="hljs-title">div</span>&gt;
</span></code></pre>
<p>HTML コンテントを表示するためには、<span class="broken-link">yii\helpers\HtmlPurifier</span> を使って、最初にコンテントをフィルタします。
例えば、次のコードは、投稿のコンテントを表示する前にフィルタしています。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">helpers</span>\<span class="hljs-title">HtmlPurifier</span>;
<span class="hljs-preprocessor">?&gt;</span>

&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>="<span class="hljs-title">post</span>"&gt;
    &lt;?= <span class="hljs-title">HtmlPurifier</span>::<span class="hljs-title">process</span>($<span class="hljs-title">post</span>-&gt;<span class="hljs-title">text</span>) ?&gt;
&lt;/<span class="hljs-title">div</span>&gt;
</span></code></pre>
<blockquote class="tip"><p><strong>Tip: </strong>HTMLPurifier は、出力を安全なものにすることにおいては素晴らしい仕事をしますが、速くはありません。
  アプリケーションが高いパフォーマンスを要求する場合は、フィルター結果を <a href="guide-caching-overview.html">キャッシュ</a> することを考慮すべきです。</p>
</blockquote>
<h3>ビューを編成する  <span id="organizing-views"></span><a href="#organizing-views" class="hashlink">&para;</a></h3><p><a href="guide-structure-controllers.html">コントローラ</a> や <a href="guide-structure-models.html">モデル</a> と同じように、ビューを編成するための規約があります。.</p>
<ul>
<li>コントローラによって表示されるビューは、デフォルトでは、ディレクトリ <code>@app/views/ControllerID</code> の下に置かれるべきものです。
ここで、<code>ControllerID</code> は <a href="guide-structure-controllers.html#routes">コントローラ ID</a> を指します。
例えば、コントローラクラスが <code>PostController</code> である場合、ディレクトリは <code>@app/views/post</code> となります。
<code>PostCommentController</code> の場合は、ディレクトリは <code>@app/views/post-comment</code> です。
また、コントローラがモジュールに属する場合は、ディレクトリは <span class="broken-link">yii\base\Module::basePath</span> の下の <code>views/ControllerID</code> です。</li>
<li><a href="guide-structure-widgets.html">ウィジェット</a> で表示されるビューは、デフォルトでは、<code>WidgetPath/views</code> ディレクトリの下に置かれるべきものです。
ここで、<code>WidgetPath</code> は、ウィジェットのクラスファイルを含んでいるディレクトリを指します。</li>
<li>他のオブジェクトによって表示されるビューについても、ウィジェットの場合と同じ規約に従うことが推奨されます。</li>
</ul>
<p>これらのデフォルトのビューディレクトリは、コントローラやウィジェットの <span class="broken-link">yii\base\ViewContextInterface::getViewPath()</span> メソッドをオーバーライドすることでカスタマイズすることが可能です。</p>
<h2>ビューをレンダリングする  <span id="rendering-views"></span><a href="#rendering-views" class="hashlink">&para;</a></h2><p><a href="guide-structure-controllers.html">コントローラ</a> の中でも、<a href="guide-structure-widgets.html">ウィジェット</a> の中でも、または、その他のどんな場所でも、ビューをレンダリングするメソッドを呼ぶことによってビューをレンダリングすることが出来ます。
これらのメソッドは、下記に示されるような類似のシグニチャを共有します。</p>
<pre><code class="hljs php"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> string $view ビュー名またはファイルパス (実際のレンダリングメソッドに依存する)
 * <span class="hljs-doctag">@param</span> array $params ビューに引き渡されるデータ
 * <span class="hljs-doctag">@return</span> string レンダリングの結果
 */</span>
methodName(<span class="hljs-variable">$view</span>, <span class="hljs-variable">$params</span> = [])
</code></pre>
<h3>コントローラでのレンダリング  <span id="rendering-in-controllers"></span><a href="#rendering-in-controllers" class="hashlink">&para;</a></h3><p><a href="guide-structure-controllers.html">コントローラ</a> の中では、ビューをレンダリングするために次のコントローラメソッドを呼ぶことが出来ます。</p>
<ul>
<li><span class="broken-link">yii\base\Controller::render()</span>: <a href="#named-views">名前付きビュー</a> をレンダリングし、その結果に <a href="#layouts">レイアウト</a> を適用する。</li>
<li><span class="broken-link">yii\base\Controller::renderPartial()</span>: <a href="#named-views">名前付きビュー</a> をレイアウトなしでレンダリングする。</li>
<li><span class="broken-link">yii\web\Controller::renderAjax()</span>: <a href="#named-views">名前付きビュー</a> をレイアウトなしでレンダリングし、登録されている全ての JS/CSS スクリプトおよびファイルを注入する。
通常、AJAX ウェブリクエストに対するレスポンスにおいて使用される。</li>
<li><span class="broken-link">yii\base\Controller::renderFile()</span>: ビューファイルのパスまたは <a href="guide-concept-aliases.html">エイリアス</a> の形式で指定されたビューをレンダリングする。</li>
<li><span class="broken-link">yii\base\Controller::renderContent()</span>: 静的な文字列をレンダリングして、現在適用可能な <a href="#layouts">レイアウト</a> に埋め込む。このメソッドは バージョン 2.0.1 以降で使用可能。</li>
</ul>
<p>例えば、</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Yii</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">models</span>\<span class="hljs-title">Post</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">NotFoundHttpException</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionView</span><span class="hljs-params">(<span class="hljs-variable">$id</span>)</span>
    </span>{
        <span class="hljs-variable">$model</span> = Post::findOne(<span class="hljs-variable">$id</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$model</span> === <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotFoundHttpException;
        }

        <span class="hljs-comment">// "view" という名前のビューをレンダリングし、レイアウトを適用する</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'view'</span>, [
            <span class="hljs-string">'model'</span> =&gt; <span class="hljs-variable">$model</span>,
        ]);
    }
}
</code></pre>
<h3>ウィジェットでのレンダリング  <span id="rendering-in-widgets"></span><a href="#rendering-in-widgets" class="hashlink">&para;</a></h3><p><a href="guide-structure-widgets.html">ウィジェット</a> の中では、ビューをレンダリングするために、次のウィジェットメソッドを使用することが出来ます。</p>
<ul>
<li><span class="broken-link">yii\base\Widget::render()</span>: <a href="#named-views">名前付きビュー</a> をレンダリングする。</li>
<li><span class="broken-link">yii\base\Widget::renderFile()</span>: ビューファイルのパスまたは <a href="guide-concept-aliases.html">エイリアス</a> の形式で指定されたビューをレンダリングする。</li>
</ul>
<p>例えば、</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">components</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">base</span>\<span class="hljs-title">Widget</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">helpers</span>\<span class="hljs-title">Html</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Widget</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$items</span> = [];

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// "list" という名前のビューをレンダリングする</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'list'</span>, [
            <span class="hljs-string">'items'</span> =&gt; <span class="hljs-variable">$this</span>-&gt;items,
        ]);
    }
}
</code></pre>
<h3>ビューでのレンダリング  <span id="rendering-in-views"></span><a href="#rendering-in-views" class="hashlink">&para;</a></h3><p><span class="broken-link">yii\base\View</span> によって提供される下記のメソッドのどれかを使うと、ビューの中で、別のビューをレンダリングすることが出来ます。</p>
<ul>
<li><span class="broken-link">yii\base\View::render()</span>: <a href="#named-views">名前付きビュー</a> をレンダリングする。</li>
<li><span class="broken-link">yii\web\View::renderAjax()</span>: <a href="#named-views">名前付きビュー</a> をレンダリングし、登録されている全ての JS/CSS スクリプトおよびファイルを注入する。
通常、AJAX ウェブリクエストに対するレスポンスにおいて使用される。</li>
<li><span class="broken-link">yii\base\View::renderFile()</span>: ビューファイルのパスまたは <a href="guide-concept-aliases.html">エイリアス</a> の形式で指定されたビューをレンダリングする。</li>
</ul>
<p>例えば、ビューの中の次のコードは、現在レンダリングされているビューと同じディレクトリにある <code>_overview.php</code> というビューファイルをレンダリングします。
ビューでは <code>$this</code> が <span class="broken-link">yii\base\View</span> コンポーネントを参照することを思い出してください。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'_overview'</span>) <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<h3>他の場所でのレンダリング  <span id="rendering-in-other-places"></span><a href="#rendering-in-other-places" class="hashlink">&para;</a></h3><p>場所がどこであれ、<code>Yii::$app-&gt;view</code> という式によって <span class="broken-link">yii\base\View</span> アプリケーションコンポーネントにアクセスすることが出来ますから、前述の <span class="broken-link">yii\base\View</span> コンポーネントメソッドを使ってビューをレンダリングすることが出来ます。
例えば、</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// ビューファイル "@app/views/site/license.php" を表示</span>
<span class="hljs-keyword">echo</span> \Yii::<span class="hljs-variable">$app</span>-&gt;view-&gt;renderFile(<span class="hljs-string">'@app/views/site/license.php'</span>);
</code></pre>
<h3>名前付きビュー  <span id="named-views"></span><a href="#named-views" class="hashlink">&para;</a></h3><p>ビューをレンダリングするとき、ビューを指定するのには、ビューの名前か、ビューファイルのパス/エイリアスか、どちらかを使うことが出来ます。
たいていの場合は、より簡潔で柔軟な前者を使います。
名前を使って指定されるビューを <em>名前付きビュー</em> と呼びます。</p>
<p>ビューの名前は、以下の規則に従って、対応するビューファイルのパスに解決されます。</p>
<ul>
<li>ビュー名はファイル拡張子を省略することが出来ます。その場合、<code>.php</code> が拡張子として使われます。
例えば、<code>about</code> というビュー名は <code>about.php</code> というファイル名に対応します。</li>
<li>ビュー名が二つのスラッシュ (<code>//</code>) で始まる場合は、対応するビューファイルのパスは <code>@app/views/ViewName</code> となります。
つまり、ビューファイルは <span class="broken-link">yii\base\Application::viewPath</span> の下で探されます。
例えば、<code>//site/about</code> は <code>@app/views/site/about.php</code> へと解決されます。</li>
<li>ビュー名が一つのスラッシュ (<code>/</code>) で始まる場合は、ビューファイルのパスは、ビュー名の前に、現在アクティブな <a href="guide-structure-modules.html">モジュール</a> の <span class="broken-link">yii\base\Module::viewPath</span> を置くことによって形成されます。
アクティブなモジュールが無い場合は、<code>@app/views/ViewName</code> が使用されます。
例えば、<code>/user/create</code> は、現在アクティブなモジュールが <code>user</code> である場合は、<code>@app/modules/user/views/user/create.php</code> へと解決されます。
アクティブなモジュールが無い場合は、ビューファイルのパスは <code>@app/views/user/create.php</code> となります。</li>
<li>ビューが <span class="broken-link">yii\base\View::context</span> を伴ってレンダリングされ、そのコンテキストが <span class="broken-link">yii\base\ViewContextInterface</span> を実装している場合は、ビューファイルのパスは、コンテキストの <span class="broken-link">yii\base\ViewContextInterface::getViewPath()</span> をビュー名の前に置くことによって形成されます。
これは、主として、コントローラとウィジェットの中でレンダリングされるビューに当てはまります。
例えば、コンテキストが <code>SiteController</code> コントローラである場合、<code>about</code> は <code>@app/views/site/about.php</code> へと解決されます。</li>
<li>あるビューが別のビューの中でレンダリングされる場合は、後者のビューファイルを含んでいるディレクトリが前者のビュー名の前に置かれて、実際のビューファイルのパスが形成されます。
例えば、<code>item</code> は、<code>@app/views/post/index.php</code> というビューの中でレンダリングされる場合、<code>@app/views/post/item</code> へと解決されます。</li>
</ul>
<p>上記の規則によって、コントローラ <code>app\controllers\PostController</code> の中で <code>$this-&gt;render('view')</code> を呼ぶと、実際には、ビューファイル <code>@app/views/post/view.php</code> がレンダリングされ、一方、そのビューの中で <code>$this-&gt;render('_overview')</code> を呼ぶと、ビューファイル <code>@app/views/post/_overview.php</code> がレンダリングされることになります。</p>
<h3>ビューの中でデータにアクセスする  <span id="accessing-data-in-views"></span><a href="#accessing-data-in-views" class="hashlink">&para;</a></h3><p>ビューの中でデータにアクセスするためのアプローチが二つあります。「プッシュ」と「プル」です。</p>
<p>ビューをレンダリングするメソッドに二番目のパラメータとしてデータを渡すのが「プッシュ」のアプローチです。
データは、「名前-値」のペアの配列として表わされなければなりません。
ビューがレンダリングされるときに、PHP の <code>extract()</code> 関数がこの配列に対して呼び出され、ビューの中で使う変数が抽出されます。
例えば、次のコードはコントローラの中でビューをレンダリングしていますが、<code>report</code> ビューに二つの変数、すなわち、<code>$foo = 1</code> と <code>$bar = 2</code> をプッシュしています。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">echo</span> <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'report'</span>, [
    <span class="hljs-string">'foo'</span> =&gt; <span class="hljs-number">1</span>,
    <span class="hljs-string">'bar'</span> =&gt; <span class="hljs-number">2</span>,
]);
</code></pre>
<p>「プル」のアプローチは、<span class="broken-link">yii\base\View</span> またはビューからアクセス出来るその他のオブジェクト (例えば <code>Yii::$app</code>) から積極的にデータを読み出すものです。
下記のコード例のように、ビューの中では <code>$this-&gt;context</code> という式でコントローラオブジェクトを取得することが出来ます。
その結果、<code>report</code> ビューの中で、コントローラの全てのプロパティやメソッドにアクセスすることが出来ます。
次の例ではコントローラ ID にアクセスしています。</p>
<pre><code class="hljs php language-php">The controller ID is: <span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$this</span>-&gt;context-&gt;id <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>通常は「プッシュ」アプローチが、ビューでデータにアクセスする方法として推奨されます。
なぜなら、ビューのコンテキストオブジェクトに対する依存がより少ないからです。
その短所は、常にデータ配列を手作業で作成する必要がある、ということです。
ビューが共有されてさまざまな場所でレンダリングされる場合、その作業が面倒くさくなり、また、間違いも生じやすくなります。</p>
<h3>ビューの間でデータを共有する  <span id="sharing-data-among-views"></span><a href="#sharing-data-among-views" class="hashlink">&para;</a></h3><p><span class="broken-link">yii\base\View</span> が提供する <span class="broken-link">yii\base\View::params</span> プロパティを使うと、ビューの間でデータを共有することが出来ます。</p>
<p>例えば、<code>about</code> というビューで、次のようなコードを使って、パン屑リストの現在の区分を指定することが出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$this</span>-&gt;params[<span class="hljs-string">'breadcrumbs'</span>][] = <span class="hljs-string">'About Us'</span>;
</code></pre>
<p>そして、<a href="#layouts">レイアウト</a> ファイル (これも一つのビューです) の中で、<span class="broken-link">yii\base\View::params</span> によって渡されたデータを使って、パン屑リストを表示することが出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?</span>= yii\widgets\Breadcrumbs::widget([
    <span class="hljs-string">'links'</span> =&gt; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$this</span>-&gt;params[<span class="hljs-string">'breadcrumbs'</span>]) ? <span class="hljs-variable">$this</span>-&gt;params[<span class="hljs-string">'breadcrumbs'</span>] : [],
]) <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<h2>レイアウト  <span id="layouts"></span><a href="#layouts" class="hashlink">&para;</a></h2><p>レイアウトは、複数のビューの共通部分をあらわす特殊なタイプのビューです。
例えば、たいていのウェブアプリケーションでは、ページは共通のヘッダとフッタを持っています。
すべてのビューで同じヘッダとフッタを繰り返すことも出来ますが、もっと良い方法は、そういうことはレイアウトの中で一度だけして、コンテントビューのレンダリング結果をレイアウトの中の適切な場所に埋め込むことです。</p>
<h3>レイアウトを作成する  <span id="creating-layouts"></span><a href="#creating-layouts" class="hashlink">&para;</a></h3><p>レイアウトもまたビューですので、通常のビューと同様な方法で作成することが出来ます。
デフォルトでは、レイアウトは <code>@app/views/layouts</code> ディレクトリに保存されます。
<a href="guide-structure-modules.html">モジュール</a> の中で使用されるレイアウトについては、<span class="broken-link">yii\base\Module::basePath</span> の下の <code>views/layouts</code> ディレクトリに保存されるべきものとなります。
デフォルトのレイアウトディレクトリは、アプリケーションまたはモジュールの <span class="broken-link">yii\base\Module::layoutPath</span> プロパティを構成することでカスタマイズすることが出来ます。</p>
<p>次の例は、レイアウトがどのようなものであるかを示すものです。説明のために、レイアウトの中のコードを大幅に単純化していることに注意してください。
実際には、ヘッドのタグやメインメニューなど、もっと多くのコンテントを追加する必要があるでしょう。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">helpers</span>\<span class="hljs-title">Html</span>;

<span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $this yii\web\View */</span>
<span class="hljs-comment">/* <span class="hljs-doctag">@var</span> $content string */</span>
<span class="hljs-preprocessor">?&gt;</span>
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;beginPage() <span class="hljs-preprocessor">?&gt;</span>
&lt;!DOCTYPE html&gt;
&lt;html lang=<span class="hljs-string">"en"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span class="hljs-string">"UTF-8"</span>/&gt;
    <span class="hljs-preprocessor">&lt;?</span>= Html::csrfMetaTags() <span class="hljs-preprocessor">?&gt;</span>
    &lt;title&gt;<span class="hljs-preprocessor">&lt;?</span>= Html::encode(<span class="hljs-variable">$this</span>-&gt;title) <span class="hljs-preprocessor">?&gt;</span>&lt;/title&gt;
    <span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;head() <span class="hljs-preprocessor">?&gt;</span>
&lt;/head&gt;
&lt;body&gt;
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;beginBody() <span class="hljs-preprocessor">?&gt;</span>
    &lt;header&gt;My Company&lt;/header&gt;
    <span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$content</span> <span class="hljs-preprocessor">?&gt;</span>
    &lt;footer&gt;&amp;copy; <span class="hljs-number">2014</span> by My Company&lt;/footer&gt;
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;endBody() <span class="hljs-preprocessor">?&gt;</span>
&lt;/body&gt;
&lt;/html&gt;
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;endPage() <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>ご覧のように、レイアウトはすべてのページに共通な HTML タグを生成しています。
<code>&lt;body&gt;</code> セクションの中でレイアウトが <code>$content</code> という変数をエコーしていますが、これは、コンテントビューのレンダリング結果を表すものであり、<span class="broken-link">yii\base\Controller::render()</span> が呼ばれるときに、レイアウトにプッシュされるものです。</p>
<p>上記のコードに示されているように、たいていのレイアウトは次に挙げるメソッドを呼び出さなければなりません。
これらのメソッドは、主としてレンダリングの過程に関するイベントをトリガするもので、他の場所で登録されたスクリプトやタグが、メソッドが呼ばれた場所に正しく注入されるようにするためのものです。</p>
<ul>
<li><p>これは、ページの開始を示す <span class="broken-link">yii\base\View::EVENT_BEGIN_PAGE</span> イベントをトリガします。</p>
</li>
<li><p>これは、ページの終了を示す <span class="broken-link">yii\base\View::EVENT_END_PAGE</span> イベントをトリガします。</p>
</li>
<li><span class="broken-link">yii\web\View::head()</span>: このメソッドが HTML ページの <code>&lt;head&gt;</code> セクションの中で呼ばれなければなりません。
このメソッドは、ページのレンダリングが完了したときに、登録された head の HTML コード (リンクタグ、メタタグなど) に置き換えられるプレースホルダを生成します。</li>
<li><span class="broken-link">yii\web\View::beginBody()</span>: このメソッドが <code>&lt;body&gt;</code> セクションの冒頭で呼ばれなければなりません。
このメソッドは <span class="broken-link">yii\web\View::EVENT_BEGIN_BODY</span> イベントをトリガし、body の開始位置をターゲットとする登録された HTML コード (JavaScript など) によって置き換えられるプレースホルダを生成します。</li>
<li><span class="broken-link">yii\web\View::endBody()</span>: このメソッドが <code>&lt;body</code>&gt; セクションの末尾で呼ばれるなければなりません。
このメソッドは  <span class="broken-link">yii\web\View::EVENT_END_BODY</span> イベントをトリガし、body の終了位置をターゲットとする登録された HTML コード (JavaScript など) によって置き換えられるプレースホルダを生成します。</li>
</ul>
<h3>レイアウトでデータにアクセスする  <span id="accessing-data-in-layouts"></span><a href="#accessing-data-in-layouts" class="hashlink">&para;</a></h3><p>レイアウトの中では、事前定義された二つの変数、すなわち、<code>$this</code> と <code>$content</code> にアクセスすることが出来ます。
前者は、通常のビューにおいてと同じく、<span class="broken-link">yii\base\View</span> コンポーネントを参照します。
一方、後者は、コントローラの中で <span class="broken-link">yii\base\Controller::render()</span> メソッドを呼ぶことによってレンダリングされる、コンテントビューのレンダリング結果を含むものです。</p>
<p>レイアウトの中でその他のデータにアクセスする必要があるときは、<a href="#accessing-data-in-views">ビューの中でデータにアクセスする</a> の項で説明されている「プル」の方法を使う必要があります。
コンテントビューからレイアウトにデータを渡す必要があるときは、<a href="#sharing-data-among-views">ビューの間でデータを共有する</a> の項で説明されている方法を使うことが出来ます。</p>
<h3>レイアウトを使う  <span id="using-layouts"></span><a href="#using-layouts" class="hashlink">&para;</a></h3><p><a href="#rendering-in-controllers">コントローラでのレンダリング</a> の項で説明されているように、コントローラの中で <span class="broken-link">yii\base\Controller::render()</span> メソッドを呼んでビューをレンダリングすると、レンダリング結果にレイアウトが適用されます。
デフォルトでは、<code>@app/views/layouts/main.php</code> というレイアウトが使用されます。</p>
<p><span class="broken-link">yii\base\Application::layout</span> または <span class="broken-link">yii\base\Controller::layout</span> のどちらかを構成することによって、異なるレイアウトを使うことが出来ます。
前者は全てのコントローラによって使用されるレイアウトを決定するものですが、後者は個々のコントローラについて前者をオーバーライドするものです。
例えば、次のコードは、<code>post</code> コントローラがビューをレンダリングするときに <code>@app/views/layouts/post.php</code> をレイアウトとして使うようにするものです。
その他のコントローラは、<code>layout</code> プロパティに触れられていないと仮定すると、引き続きデフォルトの <code>@app/views/layouts/main.php</code> をレイアウトとして使います。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$layout</span> = <span class="hljs-string">'post'</span>;
    
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>モジュールに属するコントローラについては、モジュールの <span class="broken-link">yii\base\Module::layout</span> プロパティを構成して、モジュール内のコントローラに特定のレイアウトを使用することも出来ます。</p>
<p><code>layout</code> プロパティは異なるレベル (コントローラ、モジュール、アプリケーション) で構成されうるものですので、Yii は舞台裏で二つのステップを踏んで、特定のコントローラで実際に使われるレイアウトファイルが何であるかを決定します。</p>
<p>最初のステップで、Yii はレイアウトの値とコンテキストモジュールを決定します。</p>
<ul>
<li>コントローラの <span class="broken-link">yii\base\Controller::layout</span> プロパティが <code>null</code> でないときは、それをレイアウトの値として使い、コントローラの <span class="broken-link">yii\base\Controller::module</span> をコンテキストモジュールとして使う。</li>
<li><span class="broken-link">yii\base\Controller::layout</span> が <code>null</code> のときは、コントローラの祖先となっている全てのモジュール (アプリケーション自体も含む) を探して、<span class="broken-link">yii\base\Module::layout</span> プロパティが <code>null</code> でない最初のモジュールを見つける。
見つかったモジュールとその <span class="broken-link">yii\base\Module::layout</span> の値をコンテキストモジュールと選ばれたレイアウトの値とする。
そのようなモジュールが見つからなかったときは、レイアウトは適用されないということを意味する。</li>
</ul>
<p>第二のステップでは、最初のステップで決定されたレイアウトの値とコンテキストモジュールに従って、実際のレイアウトファイルを決定します。
レイアウトの値は下記のいずれかであり得ます。</p>
<ul>
<li>パスエイリアス (例えば、<code>@app/views/layouts/main</code>)。</li>
<li>絶対パス (例えば、<code>/main</code>): すなわち、スラッシュで始まるレイアウトの値の場合。
実際のレイアウトファイルはアプリケーションの <span class="broken-link">yii\base\Application::layoutPath</span> (デフォルトでは <code>@app/views/layouts</code>) の下で探される。</li>
<li>相対パス (例えば、<code>main</code>): 実際のレイアウトファイルはコンテキストモジュールの <span class="broken-link">yii\base\Module::layoutPath</span> (デフォルトでは <span class="broken-link">yii\base\Module::basePath</span> の下の <code>views/layouts</code> ディレクトリ) の下で探される。</li>
<li>真偽値 <code>false</code>: レイアウトは適用されない。</li>
</ul>
<p>レイアウトの値がファイル拡張子を含んでいない場合は、デフォルト値である <code>.php</code> を使います。</p>
<h3>入れ子のレイアウト  <span id="nested-layouts"></span><a href="#nested-layouts" class="hashlink">&para;</a></h3><p>ときとして、あるレイアウトの中に別のレイアウトを入れたい場合があるでしょう。
例えば、ウェブサイトの別々のセクションにおいて、違うレイアウトを使いたいけれども、それらのレイアウトは全て、全体としての HTML5 ページ構造を生成する同一の基本レイアウトを共有している、という場合です。
この目的を達することは、次のように、子レイアウトの中で <span class="broken-link">yii\base\View::beginContent()</span> と <span class="broken-link">yii\base\View::endContent()</span> を呼ぶことで可能になります。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;beginContent(<span class="hljs-string">'@app/views/layouts/base.php'</span>); <span class="hljs-preprocessor">?&gt;</span>

... 子レイアウトのコンテントをここに ...

<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;endContent(); <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>上のコードが示すように、子レイアウトのコンテントは <span class="broken-link">yii\base\View::beginContent()</span> と <span class="broken-link">yii\base\View::endContent()</span> によって囲まれなければなりません。
<span class="broken-link">yii\base\View::beginContent()</span> に渡されるパラメータは、親レイアウトが何であるかを指定するものです。
レイアウトのファイルまたはエイリアスのどちらかを使うことが出来ます。</p>
<p>上記のアプローチを使って、2レベル以上のレイアウトを入れ子にすることも出来ます。</p>
<h3>ブロックを使う  <span id="using-blocks"></span><a href="#using-blocks" class="hashlink">&para;</a></h3><p>ブロックを使うと、ある場所でビューコンテントを定義して、別の場所でそれを表示することが可能になります。
ブロックはたいていはレイアウトと一緒に使われます。
例えば、ブロックをコンテントビューで定義して、それをレイアウトで表示する、ということが出来ます。</p>
<p><span class="broken-link">yii\base\View::beginBlock()</span> と <span class="broken-link">yii\base\View::endBlock()</span> を呼んでブロックを定義します。
すると、そのブロックを <code>$view-&gt;blocks[$blockID]</code> によってアクセス出来るようになります。
ここで <code>$blockID</code> は、定義したときにブロックに割り当てたユニークな ID を指します。</p>
<p>次の例は、どのようにブロックを使えば、レイアウトの特定の部分をコンテントビューでカスタマイズすることが出来るかを示すものです。</p>
<p>最初に、コンテントビューで、一つまたは複数のブロックを定義します。</p>
<pre><code class="hljs php language-php">...

<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;beginBlock(<span class="hljs-string">'block1'</span>); <span class="hljs-preprocessor">?&gt;</span>

... block1 のコンテント ...

<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;endBlock(); <span class="hljs-preprocessor">?&gt;</span>

...

<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;beginBlock(<span class="hljs-string">'block3'</span>); <span class="hljs-preprocessor">?&gt;</span>

... block3 のコンテント ...

<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$this</span>-&gt;endBlock(); <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>次に、レイアウトビューで、得ることが出来ればブロックをレンダリングし、ブロックが定義されていないときは何らかのデフォルトのコンテントを表示します。</p>
<pre><code class="hljs php language-php">...
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$this</span>-&gt;blocks[<span class="hljs-string">'block1'</span>])): <span class="hljs-preprocessor">?&gt;</span>
    <span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$this</span>-&gt;blocks[<span class="hljs-string">'block1'</span>] <span class="hljs-preprocessor">?&gt;</span>
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">else</span>: <span class="hljs-preprocessor">?&gt;</span>
    ... block1 のデフォルトのコンテント ...
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">endif</span>; <span class="hljs-preprocessor">?&gt;</span>

...

<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$this</span>-&gt;blocks[<span class="hljs-string">'block2'</span>])): <span class="hljs-preprocessor">?&gt;</span>
    <span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$this</span>-&gt;blocks[<span class="hljs-string">'block2'</span>] <span class="hljs-preprocessor">?&gt;</span>
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">else</span>: <span class="hljs-preprocessor">?&gt;</span>
    ... block2 のデフォルトのコンテント ...
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">endif</span>; <span class="hljs-preprocessor">?&gt;</span>

...

<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$this</span>-&gt;blocks[<span class="hljs-string">'block3'</span>])): <span class="hljs-preprocessor">?&gt;</span>
    <span class="hljs-preprocessor">&lt;?</span>= <span class="hljs-variable">$this</span>-&gt;blocks[<span class="hljs-string">'block3'</span>] <span class="hljs-preprocessor">?&gt;</span>
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">else</span>: <span class="hljs-preprocessor">?&gt;</span>
    ... block3 のデフォルトのコンテント ...
<span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">endif</span>; <span class="hljs-preprocessor">?&gt;</span>
...
</code></pre>
<h2>ビューコンポーネントを使う  <span id="using-view-components"></span><a href="#using-view-components" class="hashlink">&para;</a></h2><p><span class="broken-link">yii\base\View</span> はビューに関連する多くの機能を提供します。
ビューコンポーネントは、<span class="broken-link">yii\base\View</span> またはその子クラスの個別のインスタンスを作成することによっても取得できますが、たいていの場合は、<code>view</code> アプリケーションコンポーネントを主として使うことになるでしょう。
このコンポーネントは <a href="guide-structure-applications.html#application-configurations">アプリケーションの構成情報</a> の中で、次のようにして構成することが出来ます。</p>
<pre><code class="hljs php language-php">[
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">'components'</span> =&gt; [
        <span class="hljs-string">'view'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'app\components\View'</span>,
        ],
        <span class="hljs-comment">// ...</span>
    ],
]
</code></pre>
<p>ビューコンポーネントは、次に挙げるビュー関連の有用な機能を提供します。それぞれについては、独立の節で更に詳細に説明されます。</p>
<ul>
<li><a href="guide-output-theming.html">テーマ</a>: ウェブサイトのテーマを開発し変更することを可能にします。</li>
<li><a href="guide-caching-fragment.html">フラグメントキャッシュ</a>: ウェブページの中の断片をキャッシュすることを可能にします。</li>
<li><a href="guide-output-client-scripts.html">クライアントスクリプトの取り扱い</a>: CSS と JavaScript の登録とレンダリングをサポートします。</li>
<li><a href="guide-structure-assets.html">アセットバンドルの取り扱い</a>: <a href="guide-structure-assets.html">アセットバンドル</a> の登録とレンダリングをサポートします。</li>
<li><a href="guide-tutorial-template-engines.html">代替のテンプレートエンジン</a>: <a href="http://twig.sensiolabs.org/">Twig</a>、<a href="http://www.smarty.net/">Smarty</a> など、他のテンプレートエンジンを使用することを可能にします。</li>
</ul>
<p>次に挙げるマイナーではあっても有用な諸機能は、ウェブページを開発するときに頻繁に使用するでしょう。</p>
<h3>ページタイトルを設定する  <span id="setting-page-titles"></span><a href="#setting-page-titles" class="hashlink">&para;</a></h3><p>どんなウェブページにもタイトルが無ければなりません。通常、タイトルタグは <a href="#layouts">layout</a> の中で表示されます。
しかし、実際においては、多くの場合、タイトルはレイアウトではなくコンテントビューで決められます。
この問題を解決するために、<span class="broken-link">yii\web\View</span> は、タイトル情報をコンテントビューからレイアウトに渡すための <span class="broken-link">yii\web\View::title</span> プロパティを提供しています。</p>
<p>この機能を利用するためには、全てのコンテントビューにおいて、次のようにタイトルを設定します。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-variable">$this</span>-&gt;title = <span class="hljs-string">'My page title'</span>;
<span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>そして、レイアウトビューで、<code>&lt;head&gt;</code> セクションに次のコードを忘れずに書くようにします。</p>
<pre><code class="hljs php language-php">&lt;title&gt;<span class="hljs-preprocessor">&lt;?</span>= Html::encode(<span class="hljs-variable">$this</span>-&gt;title) <span class="hljs-preprocessor">?&gt;</span>&lt;/title&gt;
</code></pre>
<h3>メタタグを登録する  <span id="registering-meta-tags"></span><a href="#registering-meta-tags" class="hashlink">&para;</a></h3><p>ウェブページは、通常、いろいろな関係者によって必要とされるさまざまなメタタグを生成する必要があります。
ページタイトルと同じように、メタタグは <code>&lt;head&gt;</code> セクションに出現して、通常はレイアウトの中で生成されます。</p>
<p>どのようなメタタグを生成するかをコンテントビューの中で指定したい場合は、下記のように、<span class="broken-link">yii\web\View::registerMetaTag()</span> をコンテントビューの呼ぶことが出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-variable">$this</span>-&gt;registerMetaTag([<span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'keywords'</span>, <span class="hljs-string">'content'</span> =&gt; <span class="hljs-string">'yii, framework, php'</span>]);
<span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<p>上記のコードは、ビューコンポーネントによって "keywords" メタタグを登録するものです。登録されたメタタグは、レイアウトがレンダリングを完了した後でレンダリングされます。
すなわち、レイアウトの中で <span class="broken-link">yii\web\View::head()</span> を呼び出した場所に、次の HTML コードが生成されて挿入されます。</p>
<pre><code class="hljs php language-php">&lt;meta name=<span class="hljs-string">"keywords"</span> content=<span class="hljs-string">"yii, framework, php"</span>&gt;
</code></pre>
<p><span class="broken-link">yii\web\View::registerMetaTag()</span> を複数回呼び出した場合は、メタタグが同じものか否かに関係なく、複数のメタタグが登録されることに注意してください。</p>
<p>ある型のメタタグのインスタンスが一つだけになることを保証したい場合は、このメソッドを呼ぶときに第二のパラメータとしてキーを指定することが出来ます。
例えば、次のコードでは、二つの "description" メタタグを登録していますが、二番目のものだけがレンダリングされることになります。</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$this</span>-&gt;registerMetaTag([<span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'description'</span>, <span class="hljs-string">'content'</span> =&gt; <span class="hljs-string">'俺が Yii で作ったクールなウェブサイトだぜぃ!!'</span>], <span class="hljs-string">'description'</span>);
<span class="hljs-variable">$this</span>-&gt;registerMetaTag([<span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'description'</span>, <span class="hljs-string">'content'</span> =&gt; <span class="hljs-string">'面白いアライグマに関するウェブサイトです。'</span>], <span class="hljs-string">'description'</span>);
</code></pre>
<h3>リンクタグを登録する  <span id="registering-link-tags"></span><a href="#registering-link-tags" class="hashlink">&para;</a></h3><p><a href="#registering-meta-tags">メタタグ</a> と同じように、リンクタグも多くの場合において有用なものです。
例えば、favicon をカスタマイズしたり、RSS フィードを指し示したり、OpenID を別のサーバに委任したり、等々。
リンクタグも、<span class="broken-link">yii\web\View::registerLinkTag()</span> を使って、メタタグと同じような方法で取り扱うことが出来ます。
例えば、コンテントビューにおいて、次のようにしてリンクタグを登録することが出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-variable">$this</span>-&gt;registerLinkTag([
    <span class="hljs-string">'title'</span> =&gt; <span class="hljs-string">'Yii ライブニューズ'</span>,
    <span class="hljs-string">'rel'</span> =&gt; <span class="hljs-string">'alternate'</span>,
    <span class="hljs-string">'type'</span> =&gt; <span class="hljs-string">'application/rss+xml'</span>,
    <span class="hljs-string">'href'</span> =&gt; <span class="hljs-string">'http://www.yiiframework.com/rss.xml/'</span>,
]);
</code></pre>
<p>上記のコードは、次の結果になります。</p>
<pre><code class="hljs xml language-html"><span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Yii ライブニューズ"</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"alternate"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"application/rss+xml"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://www.yiiframework.com/rss.xml/"</span>&gt;</span>
</code></pre>
<p><span class="broken-link">yii\web\View::registerMetaTag()</span> と同じように、<span class="broken-link">yii\web\View::registerLinkTag()</span> を呼ぶときにキーを指定すると、同じリンクタグを繰り返して生成するのを避けることが出来ます。</p>
<h2>ビューのイベント  <span id="view-events"></span><a href="#view-events" class="hashlink">&para;</a></h2><p><span class="broken-link">yii\base\View</span> はビューをレンダリングする過程においていくつかのイベントをトリガします。
これらのイベントに反応することによって、ビューにコンテントを注入したり、エンドユーザに送信される前にレンダリング結果を加工したりすることが出来ます。</p>
<ul>
<li><p>このイベントのハンドラは、<span class="broken-link">yii\base\ViewEvent::isValid</span> を false にセットして、レンダリングのプロセスをキャンセルすることが出来ます。</p>
</li>
<li><span class="broken-link">yii\base\View::EVENT_AFTER_RENDER</span>: ファイルのレンダリングの後、<span class="broken-link">yii\base\View::afterRender()</span> を呼ぶことによってトリガされます。
このイベントのハンドラは、レンダリング結果をプロパティ <span class="broken-link">yii\base\ViewEvent::output</span> を通じて取得して、それを修正してレンダリング結果を変更することが出来ます。</li>
<li><span class="broken-link">yii\base\View::EVENT_BEGIN_PAGE</span>: レイアウトの中で <span class="broken-link">yii\base\View::beginPage()</span> を呼ぶことによってトリガされます。</li>
<li><span class="broken-link">yii\base\View::EVENT_END_PAGE</span>: レイアウトの中で <span class="broken-link">yii\base\View::endPage()</span> を呼ぶことによってトリガされます。</li>
<li><span class="broken-link">yii\web\View::EVENT_BEGIN_BODY</span>: レイアウトの中で <span class="broken-link">yii\web\View::beginBody()</span> を呼ぶことによってトリガされます。</li>
<li><span class="broken-link">yii\web\View::EVENT_END_BODY</span>: レイアウトの中で <span class="broken-link">yii\web\View::endBody()</span> を呼ぶことによってトリガされます。</li>
</ul>
<p>例えば、次のコードはページの body の最後に現在の日付を注入するものです。</p>
<pre><code class="hljs php language-php">\Yii::<span class="hljs-variable">$app</span>-&gt;view-&gt;on(View::EVENT_END_BODY, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">echo</span> date(<span class="hljs-string">'Y-m-d'</span>);
});
</code></pre>
<h2>静的なページをレンダリングする  <span id="rendering-static-pages"></span><a href="#rendering-static-pages" class="hashlink">&para;</a></h2><p>静的なページというのは、主たるコンテントのほとんどが静的なもので、コントローラからプッシュされる動的なデータにアクセスする必要がないページを指します。</p>
<p>静的なページは、そのコードをビューに置き、そして、コントローラで次のようなコードを使うと表示することが出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionAbout</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'about'</span>);
}
</code></pre>
<p>ウェブサイトが多くの静的なページを含んでいる場合、同じようなコードを何度も繰り返すのは非常に面倒くさいでしょう。
この問題を解決するために、<span class="broken-link">yii\web\ViewAction</span> という <a href="guide-structure-controllers.html#standalone-actions">スタンドアロンアクション</a> をコントローラに導入することが出来ます。
例えば、</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actions</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'page'</span> =&gt; [
                <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\web\ViewAction'</span>,
            ],
        ];
    }
}
</code></pre>
<p>このようにすると、ディレクトリ <code>@app/views/site/pages</code> の下に <code>about</code> という名前のビューを作成したときに、次の URL によってこのビューを表示することが出来るようになります。</p>
<pre><code class="hljs less"><span class="hljs-attribute">http</span>:<span class="hljs-comment">//localhost/index.php?r=site%2Fpage&amp;view=about</span>
</code></pre>
<p><code>view</code> という <code>GET</code> パラメータが、どのビューがリクエストされているかを <span class="broken-link">yii\web\ViewAction</span> に教えます。
そこで、アクションはこのビューをディレクトリ <code>@app/views/site/pages</code> の下で探します。
<span class="broken-link">yii\web\ViewAction::viewPrefix</span> を構成して、ビューを探すディレクトリを変更することが出来ます。</p>
<h2>ベストプラクティス  <span id="best-practices"></span><a href="#best-practices" class="hashlink">&para;</a></h2><p>ビューはエンドユーザが望む形式でモデルを表現することに対して責任を持ちます。一般的に、ビューは</p>
<ul>
<li>主として表示目的のコードを含むべきです。例えば、HTML、または、データをたどって書式化してレンダリングする簡単な PHP コードなど。</li>
<li>DB クエリを実行するコードは含むべきではありません。そのようなコードはモデルの中で実行されるべきです。</li>
<li><code>$_GET</code> や <code>$_POST</code> のようなリクエストデータに直接アクセスするべきではありません。それはコントローラの仕事です。
リクエストデータが必要な場合は、コントローラからビューにプッシュされるべきです。</li>
<li>モデルのプロパティを読み出すことが出来ます。しかし、それを修正するべきではありません。</li>
</ul>
<p>ビューを管理しやすいものにするために、複雑すぎるビューや、冗長なコードをあまりに多く含むビューを作ることは避けましょう。
この目的を達するために、次のテクニックを使うことが出来ます。</p>
<ul>
<li>共通の表示セクション (ページのヘッダやフッタなど) を表すために <a href="#layouts">レイアウト</a> を使う。</li>
<li>複雑なビューはいくつかの小さなビューに分割する。既に説明したレンダリングのメソッドを使えば、小さなビューをレンダリングして大きなビューを組み上げることが出来る。</li>
<li>ビューの構成要素として <a href="guide-structure-widgets.html">ウィジェット</a> を使う。</li>
<li>ビューでデータを変換し書式化するためのヘルパクラスを作成して使う。</li>
</ul>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Tue, 27 Dec 2016 22:28:43 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
