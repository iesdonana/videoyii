<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/90d046f2/css/bootstrap.css" rel="stylesheet">
<link href="./assets/c6368d94/solarized_light.css" rel="stylesheet">
<link href="./assets/9f5cdd92/style.css" rel="stylesheet">
<script src="./assets/a6e53573/jquery.js"></script>
<script src="./assets/90d046f2/js/bootstrap.js"></script>
<script src="./assets/218ce2e5/jssearch.js"></script>    <title>Fixtures - Testing - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w11680" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w11680-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./guide-index.html">The Definitive Guide to Yii 2.0</a></div><div id="w11680-collapse" class="collapse navbar-collapse"><ul id="w11681" class="navbar-nav nav"><li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-11664" data-toggle="collapse" data-parent="#navigation">Giới thiệu <b class="caret"></b></a><div id="navigation-11664" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">Về Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Nâng cấp lên từ phiên bản 1.1</a></div>
<a class="list-group-item" href="#navigation-11665" data-toggle="collapse" data-parent="#navigation">Bắt đầu <b class="caret"></b></a><div id="navigation-11665" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Cài đặt Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Thực hiện chạy ứng dụng</a>
<a class="list-group-item" href="./guide-start-hello.html">Viết lời chào đầu tiên</a>
<a class="list-group-item" href="./guide-start-forms.html">Làm việc với Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">Làm việc với Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">Sử dụng Gii để sinh code</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Mức cao hơn</a></div>
<a class="list-group-item" href="#navigation-11666" data-toggle="collapse" data-parent="#navigation">Kiến trúc ứng dụng (Application Structure) <b class="caret"></b></a><div id="navigation-11666" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-structure-overview.html">Tổng quan về kiến trúc ứng dụng</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Mục Scripts</a>
<a class="list-group-item" href="./guide-structure-applications.html">Ứng dụng (Applications)</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Thành phần ứng dụng</a>
<a class="list-group-item" href="./guide-structure-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-structure-models.html">Models</a>
<a class="list-group-item" href="./guide-structure-views.html">Views</a>
<a class="list-group-item" href="./guide-structure-modules.html">Modules</a>
<a class="list-group-item" href="./guide-structure-filters.html">Bộ lọc (Filters)</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Widgets</a>
<a class="list-group-item" href="./guide-structure-assets.html">Assets</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Phần mở rộng (Extensions)</a></div>
<a class="list-group-item" href="#navigation-11667" data-toggle="collapse" data-parent="#navigation">Yêu cầu xử lý (Handling Requests) <b class="caret"></b></a><div id="navigation-11667" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Routing và URL Creation</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Yêu cầu (Requests)</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Responses</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions và Cookies</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Xử lý lỗi (Handling Error)</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Logging</a></div>
<a class="list-group-item" href="#navigation-11668" data-toggle="collapse" data-parent="#navigation">Các khái niệm chính <b class="caret"></b></a><div id="navigation-11668" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Thành phần (Components)</a>
<a class="list-group-item" href="./guide-concept-properties.html">Thuộc tính (Properties)</a>
<a class="list-group-item" href="./guide-concept-events.html">Sự kiện (Events)</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Hành vi (Behaviors)</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Cấu hình (Configurations)</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Bí danh (Aliases)</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Lớp tự động nạp (Autoloading)</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-11669" data-toggle="collapse" data-parent="#navigation">Làm việc với Databases <b class="caret"></b></a><div id="navigation-11669" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Data Access Objects</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Query Builder</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Migrations</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elasticsearch.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-11670" data-toggle="collapse" data-parent="#navigation">Nhận dữ liệu từ user <b class="caret"></b></a><div id="navigation-11670" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Tạo mới Forms</a>
<a class="list-group-item" href="./guide-input-validation.html">Kiểm tra dữ liệu đầu vào (Validating Input)</a>
<a class="list-group-item" href="./guide-input-file-upload.html">File Upload</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Thu thập dữ liệu từ danh sách đầu vào (Đang phát triển)</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Lấy dữ liệu cho nhiều Models (Chưa giải quyết)</a></div>
<a class="list-group-item" href="#navigation-11671" data-toggle="collapse" data-parent="#navigation">Hiển thị dữ liệu <b class="caret"></b></a><div id="navigation-11671" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatter.html">Định dạng dữ liệu (Data Formatting)</a>
<a class="list-group-item" href="./guide-output-pagination.html">Phân trang (Pagination)</a>
<a class="list-group-item" href="./guide-output-sorting.html">Sắp xếp (Sorting)</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Cung cấp dữ liệu ra (Data Providers)</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Dữ liệu Widgets</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">làm việc với Client Scripts</a>
<a class="list-group-item" href="./guide-output-theming.html">Giao diện (Theming)</a></div>
<a class="list-group-item" href="#navigation-11672" data-toggle="collapse" data-parent="#navigation">Bảo mật (Security) <b class="caret"></b></a><div id="navigation-11672" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-security-authorization.html">Quyền (Authorization)</a>
<a class="list-group-item" href="./guide-security-passwords.html">Các thao tác xử lý với Passwords (Đang phát triển)</a>
<a class="list-group-item" href="./guide-security-auth-clients.html">Auth Clients</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Best Practices</a></div>
<a class="list-group-item" href="#navigation-11673" data-toggle="collapse" data-parent="#navigation">Bộ nhớ Cache <b class="caret"></b></a><div id="navigation-11673" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-caching-data.html">Cache dữ liệu</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Fragment Caching</a>
<a class="list-group-item" href="./guide-caching-page.html">Page Caching</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP Caching</a></div>
<a class="list-group-item" href="#navigation-11674" data-toggle="collapse" data-parent="#navigation">RESTful Web Services <b class="caret"></b></a><div id="navigation-11674" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Bắt đầu</a>
<a class="list-group-item" href="./guide-rest-resources.html">Tài nguyên (Resources)</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-rest-routing.html">Routing</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Định dạng thông điệp gửi đi (Response Formatting)</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Rate Limiting</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Phiên bản (Version)</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Error Handling</a></div>
<a class="list-group-item" href="#navigation-11675" data-toggle="collapse" data-parent="#navigation">Công cụ phát triển (Development Tools) <b class="caret"></b></a><div id="navigation-11675" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">Thanh công cụ gỡ lỗi và sửa lỗi (Debug Toolbar và Debugger)</a>
<a class="list-group-item" href="./guide-tool-gii.html">Sử dụng Gii để tạo code</a>
<a class="list-group-item" href="./guide-tool-api-doc.html">Tạo tài liệu về API </a></div>
<a class="list-group-item active" href="#navigation-11676" data-toggle="collapse" data-parent="#navigation">Testing <b class="caret"></b></a><div id="navigation-11676" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-test-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Thiết lập môi trường</a>
<a class="list-group-item" href="./guide-test-unit.html">Unit Tests</a>
<a class="list-group-item" href="./guide-test-functional.html">Kiểm tra chức năng (Functional Tests)</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Acceptance Tests</a>
<a class="list-group-item active" href="./guide-test-fixtures.html">Fixtures</a></div>
<a class="list-group-item" href="#navigation-11677" data-toggle="collapse" data-parent="#navigation">Chủ đề năng cao <b class="caret"></b></a><div id="navigation-11677" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">Advanced Application Template</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Building Application from Scratch</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Giao diện dòng lệnh (Console Commands)</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Core Validators</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Quốc tế hóa (Internationalization)</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Thư (Mailing)</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Tối ưu hiệu năng ứng dụng (Performance Tuning)</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Shared Hosting Environment</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Template Engines</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Working with Third-Party Code</a></div>
<a class="list-group-item" href="#navigation-11678" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-11678" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap Widgets</a>
<a class="list-group-item" href="./guide-widget-jui.html">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-11679" data-toggle="collapse" data-parent="#navigation">Helpers <b class="caret"></b></a><div id="navigation-11679" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>フィクスチャ <span id="fikusucha"></span><a href="#fikusucha" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#fikusuchawo-ding-yisuru">フィクスチャを定義する</a></li>
<li><a href="#fikusuchawo-shi-yongsuru">フィクスチャを使用する</a></li>
<li><a href="#gurobarufikusuchawo-ding-yishite-shi-yongsuru">グローバルフィクスチャを定義して使用する</a></li>
<li><a href="#fikusuchakurasutodetafairuwo-bian-chengsuru">フィクスチャクラスとデータファイルを編成する</a></li>
<li><a href="#matome">まとめ</a></li>
<li><a href="#fixtures-format">Fixtures format</a></li>
<li><a href="#loading-fixtures">Loading fixtures</a></li>
<li><a href="#unloading-fixtures">Unloading fixtures</a></li>
<li><a href="#configure-command-globally">Configure Command Globally</a></li>
<li><a href="#auto-generating-fixtures">Auto-generating fixtures</a></li></ol></div>
<p>フィクスチャはテストの重要な部分です。
フィクスチャの主な目的は、テストを期待されている方法で繰り返して実行できるように、環境を固定された既知の状態に設定することです。
Yii は、フィクスチャを正確に定義して容易に使うことを可能にするフィクスチャフレームワークを提供しています。</p>
<p>Yii のフィクスチャフレームワークにおける鍵となる概念は、いわゆる <em>フィクスチャオブジェクト</em> です。
フィクスチャオブジェクトはテスト環境のある特定の側面を表現するもので、<span class="broken-link">yii\test\Fixture</span> またはその子クラスのインスタンスです。
例えば、ユーザの DB テーブルが固定されたデータセットを含むことを保証するために <code>UserFixture</code> を使う、という具合です。
テストを実行する前に一つまたは複数のフィクスチャオブジェクトをロードし、テストの完了時にアンロードします。</p>
<p>フィクスチャは他のフィクスチャに依存する場合があります。依存は <span class="broken-link">yii\test\Fixture::depends</span> プロパティによって定義されます。
フィクスチャがロードされるとき、依存するフィクスチャはそのフィクスチャの前に自動的にロードされます。
そしてフィクスチャがアンロードされるときには、依存するフィクスチャはそのフィクスチャの後にアンロードされます。</p>
<h2>フィクスチャを定義する <span id="fikusuchawo-ding-yisuru"></span><a href="#fikusuchawo-ding-yisuru" class="hashlink">&para;</a></h2><p>フィクスチャを定義するためには、<span class="broken-link">yii\test\Fixture</span> または <span class="broken-link">yii\test\ActiveFixture</span> を拡張して新しいクラスを作ります。
前者は汎用目的のフィクスチャに最も適しています。
一方、後者はデータベースとアクティブレコードを扱うために専用に設計された拡張機能を持っています。</p>
<p>次のコードは、<code>User</code> アクティブレコードとそれに対応するテーブルに関して、フィクスチャを定義するものです。</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">tests</span>\<span class="hljs-title">fixtures</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">test</span>\<span class="hljs-title">ActiveFixture</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserFixture</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActiveFixture</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$modelClass</span> = <span class="hljs-string">'app\models\User'</span>;
}
</code></pre>
<blockquote class="tip"><p><strong>Tip: </strong>すべての <code>ActiveFixture</code> は、テストの目的のために DB テーブルを準備するものです。
<span class="broken-link">yii\test\ActiveFixture::tableName</span> プロパティまたは <span class="broken-link">yii\test\ActiveFixture::modelClass</span> プロパティを設定することによって、テーブルを指定することが出来ます。
後者を使う場合は、<code>modelClass</code> によって指定される <code>ActiveRecord</code> クラスからテーブル名が取得されます。</p>
</blockquote>
<blockquote class="note"><p><strong>Note: </strong><span class="broken-link">yii\test\ActiveFixture</span> は SQL データベースにのみ適しています。
NoSQL データベースのためには、Yii は以下の <code>ActiveFixture</code> クラスを提供しています。</p>
<ul>
<li>Mongo DB: <span class="broken-link">yii\mongodb\ActiveFixture</span></li>
<li>Elasticsearch: <span class="broken-link">yii\elasticsearch\ActiveFixture</span> (バージョン 2.0.2 以降)</li>
</ul>
</blockquote>
<p><code>ActiveFixture</code> フィクスチャのフィクスチャデータは通常は <code>FixturePath/data/TableName.php</code> として配置されるファイルで提供されます。
ここで <code>FixturePath</code> はフィクスチャクラスファイルを含むディレクトリを意味し、<code>TableName</code> はフィクスチャと関連付けられているテーブルの名前です。
上記の例では、ファイルは <code>@app/tests/fixtures/data/user.php</code> となります。
データファイルは、ユーザのテーブルに挿入されるデータ行の配列を返さなければなりません。
例えば、</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">return</span> [
    <span class="hljs-string">'user1'</span> =&gt; [
        <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'lmayert'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'strosin.vernice@jerde.com'</span>,
        <span class="hljs-string">'auth_key'</span> =&gt; <span class="hljs-string">'K3nF70it7tzNsHddEiq0BZ0i-OU8S3xV'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$13$WSyE5hHsG1rWN2jV8LRHzubilrCLI5Ev/iK0r3jRuwQEs2ldRu.a2'</span>,
    ],
    <span class="hljs-string">'user2'</span> =&gt; [
        <span class="hljs-string">'username'</span> =&gt; <span class="hljs-string">'napoleon69'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'aileen.barton@heaneyschumm.com'</span>,
        <span class="hljs-string">'auth_key'</span> =&gt; <span class="hljs-string">'dZlXsVnIDgIzFgX4EduAqkEPuphhOh9q'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$13$kkgpvJ8lnjKo8RuoR30ay.RjDf15bMcHIF7Vz1zz/6viYG5xJExU6'</span>,
    ],
];
</code></pre>
<p>データ行にはエイリアスを付けることが出来て、後でテストのときにエイリアスを使って行を参照することが出来ます。
上の例では、二つの行はそれぞれ <code>user1</code> および <code>user2</code> というエイリアスを付けられています。</p>
<p>また、オートインクリメントのカラムに対してはデータを指定する必要はありません。
フィクスチャがロードされるときに Yii が自動的に実際の値を行に入れます。</p>
<blockquote class="tip"><p><strong>Tip: </strong><span class="broken-link">yii\test\ActiveFixture::dataFile</span> プロパティを設定して、データファイルの所在をカスタマイズすることが出来ます。
<span class="broken-link">yii\test\ActiveFixture::getData()</span> をオーバーライドしてデータを提供することも可能です。</p>
</blockquote>
<p>前に説明したように、フィクスチャは別のフィクスチャに依存する場合があります。
例えば、ユーザプロファイルのテーブルはユーザのテーブルを指す外部キーを含んでいるため、<code>UserProfileFixture</code> は <code>UserFixture</code> に依存します。
依存関係は、次のように、<span class="broken-link">yii\test\Fixture::depends</span> プロパティによって指定されます。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">tests</span>\<span class="hljs-title">fixtures</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">test</span>\<span class="hljs-title">ActiveFixture</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProfileFixture</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActiveFixture</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$modelClass</span> = <span class="hljs-string">'app\models\UserProfile'</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$depends</span> = [<span class="hljs-string">'app\tests\fixtures\UserFixture'</span>];
}
</code></pre>
<p>依存関係は、また、複数のフィクスチャが正しく定義された順序でロードされ、アンロードされることを保証します。
上記の例では、全ての外部キー参照が存在することを保証するために <code>UserFixture</code> は常に <code>UserProfileFixture</code> の前にロードされます。
また、同じ理由によって、<code>UserFixture</code> は常に <code>UserProfileFixture</code> がアンロードされた後でアンロードされます。</p>
<p>上記では、DB テーブルに関してフィクスチャを定義する方法を示しました。
DB と関係しないフィクスチャ (例えば、何らかのファイルやディレクトリに関するフィクスチャ) を定義するためには、より汎用的な基底クラス <span class="broken-link">yii\test\Fixture</span> から拡張して、<span class="broken-link">yii\test\Fixture::load()</span> と <span class="broken-link">yii\test\Fixture::unload()</span> のメソッドをオーバーライドすることが出来ます。</p>
<h2>フィクスチャを使用する <span id="fikusuchawo-shi-yongsuru"></span><a href="#fikusuchawo-shi-yongsuru" class="hashlink">&para;</a></h2><p><a href="http://codeception.com/">Codeception</a> を使ってコードをテストしている場合は、フィクスチャのローディングとアクセスを内蔵でサポートしている <code>yii2-codeception</code> を使用することを検討すべきです。
その他のテストフレームワークを使っている場合は、テストケースで <span class="broken-link">yii\test\FixtureTrait</span> を使って同じ目的を達することが出来ます。</p>
<p>次に <code>yii2-codeception</code> を使って <code>UserProfile</code> 単体テストを書く方法を説明します。</p>
<p><span class="broken-link">yii\codeception\DbTestCase</span> または <span class="broken-link">yii\codeception\TestCase</span> を拡張する単体テストクラスにおいて、どのフィクスチャを使用したいかを <span class="broken-link">yii\test\FixtureTrait::fixtures()</span> メソッドの中で宣言します。
例えば、</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">tests</span>\<span class="hljs-title">unit</span>\<span class="hljs-title">models</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">codeception</span>\<span class="hljs-title">DbTestCase</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">tests</span>\<span class="hljs-title">fixtures</span>\<span class="hljs-title">UserProfileFixture</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserProfileTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DbTestCase</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fixtures</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> [
            <span class="hljs-string">'profiles'</span> =&gt; UserProfileFixture::className(),
        ];
    }

    <span class="hljs-comment">// ... テストのメソッド ...</span>
}
</code></pre>
<p><code>fixtures()</code> メソッドにリストされたメソッドは、テストケースの中のどのテストメソッドが走る前にも自動的にロードされ、テストメソッドが完了した後にアンロードされます。
前に説明したように、フィクスチャがロードされるときには、それが依存するフィクスチャのすべてが最初に自動的にロードされます。
上の例では、<code>UserProfileFixture</code> は <code>UserFixture</code> に依存しているので、テストクラスのどのテストメソッドを走らせるときでも、二つのフィクスチャが連続してロードされます。
すなわち、最初に <code>UserFixture</code> がロードされ、次に <code>UserProfileFixture</code> がロードされます。</p>
<p><code>fixtures()</code> でフィクスチャを指定するときは、クラス名あるいはフィクスチャを指す構成情報配列を使うことが出来ます。
構成情報配列を使うと、フィクスチャがロードされるときのフィクスチャのプロパティをカスタマイズすることが出来ます。</p>
<p>また、フィクスチャにエイリアスを割り当てることも出来ます。
上記の例では、<code>UserProfileFixture</code> に <code>profiles</code> というエイリアスが与えられています。
そうすると、テストメソッドの中でエイリアスを使ってフィクスチャオブジェクトにアクセスすることが出来るようになります。
例えば、<code>$this-&gt;profiles</code> が <code>UserProfileFixture</code> を返すことになります。</p>
<p>さらには、<code>UserProfileFixture</code> は <code>ActiveFixture</code> を拡張するものですので、フィクスチャによって提供されたデータに対して、次の構文を使ってアクセスすることも出来ます。</p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// 'user1' というエイリアスのデータ行を返す</span>
<span class="hljs-variable">$row</span> = <span class="hljs-variable">$this</span>-&gt;profiles[<span class="hljs-string">'user1'</span>];
<span class="hljs-comment">// 'user1' というエイリアスのデータ行に対応する UserProfileModel を返す</span>
<span class="hljs-variable">$profile</span> = <span class="hljs-variable">$this</span>-&gt;profiles(<span class="hljs-string">'user1'</span>);
<span class="hljs-comment">// フィクスチャにある全てのデータ行をたどる</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$this</span>-&gt;profiles <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) ...
</code></pre>
<blockquote class="info"><p><strong>Info: </strong><code>$this-&gt;profiles</code> は依然として <code>UserProfileFixture</code> という型です。
上記のアクセス機能は PHP マジックメソッドによって実装されています。</p>
</blockquote>
<h2>グローバルフィクスチャを定義して使用する <span id="gurobarufikusuchawo-ding-yishite-shi-yongsuru"></span><a href="#gurobarufikusuchawo-ding-yishite-shi-yongsuru" class="hashlink">&para;</a></h2><p>上記で説明されたフィクスチャは主として個別のテストケースによって使われます。
たいていの場合、全てまたは多くのテストケースに適用されるグローバルなフィクスチャもいくつか必要になります。
一例は、<span class="broken-link">yii\test\InitDbFixture</span> で、これは二つのことをします。</p>
<ul>
<li><code>@app/tests/fixtures/initdb.php</code> に配置されたスクリプトを実行して、いくつかの共通の初期化作業を行う。</li>
<li>他の DB フィクスチャをロードする前に、データベースの整合性チェックを無効化し、他の DB フィクスチャがアンロードされた後で、それを再び有効化する。</li>
</ul>
<p>グローバルフィクスチャの使い方は、グローバルでないフィクスチャと同じです。
違うところは、グローバルフィクスチャは <code>fixtures()</code> ではなく <span class="broken-link">yii\codeception\TestCase::globalFixtures()</span> で宣言するという点です。
テストケースがフィクスチャをロードするときは、最初にグローバルフィクスチャをロードし、次にグローバルでないものをロードします。</p>
<p>デフォルトでは、<span class="broken-link">yii\codeception\DbTestCase</span> は <code>InitDbFixture</code> を <code>globalFixtures()</code> メソッドの中で既に宣言しています。
このことは、どのテストの前にも何らかの初期化作業をしたい場合は、<code>@app/tests/fixtures/initdb.php</code> だけを触ればよいことを意味します。
その必要がなければ、単にそれぞれの個別テストケースとそれに対応するフィクスチャの開発に専念することが出来ます。</p>
<h2>フィクスチャクラスとデータファイルを編成する <span id="fikusuchakurasutodetafairuwo-bian-chengsuru"></span><a href="#fikusuchakurasutodetafairuwo-bian-chengsuru" class="hashlink">&para;</a></h2><p>デフォルトでは、フィクスチャクラスは対応するデータファイルを探すときに、フィクスチャのクラスファイルを含むフォルダのサブフォルダである <code>data</code> フォルダの中を見ます。
簡単なプロジェクトではこの規約に従うことができます。
大きなプロジェクトでは、おそらくは、同じフィクスチャクラスを異なるテストに使うために、データファイルを切り替える必要がある場合が頻繁に生じるでしょう。
従って、クラスの名前空間と同じように、データファイルを階層的な方法で編成することを推奨します。
例えば、</p>
<pre><code class="hljs css"># <span class="hljs-tag">tests</span>\<span class="hljs-tag">unit</span>\<span class="hljs-tag">fixtures</span> フォルダの下に

<span class="hljs-tag">data</span>\
    <span class="hljs-tag">components</span>\
        <span class="hljs-tag">fixture_data_file1</span><span class="hljs-class">.php</span>
        <span class="hljs-tag">fixture_data_file2</span><span class="hljs-class">.php</span>
        ...
        <span class="hljs-tag">fixture_data_fileN</span><span class="hljs-class">.php</span>
    <span class="hljs-tag">models</span>\
        <span class="hljs-tag">fixture_data_file1</span><span class="hljs-class">.php</span>
        <span class="hljs-tag">fixture_data_file2</span><span class="hljs-class">.php</span>
        ...
        <span class="hljs-tag">fixture_data_fileN</span><span class="hljs-class">.php</span>
# 等々
</code></pre>
<p>このようにして、テスト間でフィクスチャのデータファイルが衝突するのを回避し、必要に応じてデータファイルを使い分けます。</p>
<blockquote class="note"><p><strong>Note: </strong>上の例では、フィクスチャファイルには例示目的だけの名前が付けられています。
実際の現場では、フィクスチャクラスの拡張元である基底クラスに従って名前を付けるべきです。
例えば、DB フィクスチャを <span class="broken-link">yii\test\ActiveFixture</span> から拡張している場合は、DB テーブルの名前をフィクスチャのデータファイル名として使うべきです。
MongoDB フィクスチャを <span class="broken-link">yii\mongodb\ActiveFixture</span> から拡張している場合は、コレクション名をファイル名として使うべきです。</p>
</blockquote>
<p>同様な階層は、フィクスチャクラスファイルを編成するのにも使うことが出来ます。
<code>data</code> をルートディレクトリとして使うのでなく、データファイルとの衝突を避けるために <code>fixtures</code> をルートディレクトリとして使うのが良いでしょう。</p>
<h2>まとめ <span id="matome"></span><a href="#matome" class="hashlink">&para;</a></h2><p>以上、フィクスチャを定義して使用する方法を説明しました。
下記に、DB に関連したユニットテストを走らせる場合の典型的なワークフローをまとめておきます。</p>
<ol>
<li><code>yii migrate</code> ツールを使って、テストのデータベースを最新版にアップグレードする</li>
<li>テストケースを走らせる<ul>
<li>フィクスチャをロードする - 関係する DB テーブルをクリーンアップし、フィクスチャデータを投入する</li>
<li>実際のテストを実行する</li>
<li>フィクスチャをアンロードする</li>
</ul>
</li>
<li>全てのテストが完了するまで、ステップ 2 を繰り返す</li>
</ol>
<p>(以下は削除または大幅に改稿される可能性が高いので、当面、翻訳を見合わせます)</p>
<p><strong>To be cleaned up below</strong></p>
<h1>Managing Fixtures <span id="managing-fixtures"></span><a href="#managing-fixtures" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#fikusuchawo-ding-yisuru">フィクスチャを定義する</a></li>
<li><a href="#fikusuchawo-shi-yongsuru">フィクスチャを使用する</a></li>
<li><a href="#gurobarufikusuchawo-ding-yishite-shi-yongsuru">グローバルフィクスチャを定義して使用する</a></li>
<li><a href="#fikusuchakurasutodetafairuwo-bian-chengsuru">フィクスチャクラスとデータファイルを編成する</a></li>
<li><a href="#matome">まとめ</a></li>
<li><a href="#fixtures-format">Fixtures format</a></li>
<li><a href="#loading-fixtures">Loading fixtures</a></li>
<li><a href="#unloading-fixtures">Unloading fixtures</a></li>
<li><a href="#configure-command-globally">Configure Command Globally</a></li>
<li><a href="#auto-generating-fixtures">Auto-generating fixtures</a></li></ol></div>
<blockquote class="note"><p><strong>Note: </strong>This section is under development.</p>
<p>todo: this tutorial may be merged with the above part of test-fixtures.md</p>
</blockquote>
<p>Fixtures are important part of testing. Their main purpose is to populate you with data that needed by testing
different cases. With this data using your tests becoming more efficient and useful.</p>
<p>Yii supports fixtures via the <code>yii fixture</code> command line tool. This tool supports:</p>
<ul>
<li>Loading fixtures to different storage such as: RDBMS, NoSQL, etc;</li>
<li>Unloading fixtures in different ways (usually it is clearing storage);</li>
<li>Auto-generating fixtures and populating it with random data.</li>
</ul>
<h2>Fixtures format <span id="fixtures-format"></span><a href="#fixtures-format" class="hashlink">&para;</a></h2><p>Fixtures are objects with different methods and configurations, refer to official <a href="https://github.com/yiisoft/yii2/blob/master/docs/guide/test-fixtures.md">documentation</a> on them.
Lets assume we have fixtures data to load:</p>
<pre><code class="hljs php"><span class="hljs-comment">#users.php file under fixtures data path, by default @tests\unit\fixtures\data</span>

<span class="hljs-keyword">return</span> [
    [
        <span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'Chase'</span>,
        <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'lmayert'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'strosin.vernice@jerde.com'</span>,
        <span class="hljs-string">'auth_key'</span> =&gt; <span class="hljs-string">'K3nF70it7tzNsHddEiq0BZ0i-OU8S3xV'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$13$WSyE5hHsG1rWN2jV8LRHzubilrCLI5Ev/iK0r3jRuwQEs2ldRu.a2'</span>,
    ],
    [
        <span class="hljs-string">'name'</span> =&gt; <span class="hljs-string">'Celestine'</span>,
        <span class="hljs-string">'login'</span> =&gt; <span class="hljs-string">'napoleon69'</span>,
        <span class="hljs-string">'email'</span> =&gt; <span class="hljs-string">'aileen.barton@heaneyschumm.com'</span>,
        <span class="hljs-string">'auth_key'</span> =&gt; <span class="hljs-string">'dZlXsVnIDgIzFgX4EduAqkEPuphhOh9q'</span>,
        <span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$13$kkgpvJ8lnjKo8RuoR30ay.RjDf15bMcHIF7Vz1zz/6viYG5xJExU6'</span>,
    ],
];
</code></pre>
<p>If we are using fixture that loads data into database then these rows will be applied to <code>users</code> table. If we are using nosql fixtures, for example <code>mongodb</code>
fixture, then this data will be applied to <code>users</code> mongodb collection. In order to learn about implementing various loading strategies and more, refer to official <a href="https://github.com/yiisoft/yii2/blob/master/docs/guide/test-fixtures.md">documentation</a>.
Above fixture example was auto-generated by <code>yii2-faker</code> extension, read more about it in these <a href="#auto-generating-fixtures">section</a>.
Fixture classes name should not be plural.</p>
<h2>Loading fixtures <span id="loading-fixtures"></span><a href="#loading-fixtures" class="hashlink">&para;</a></h2><p>Fixture classes should be suffixed by <code>Fixture</code> class. By default fixtures will be searched under <code>tests\unit\fixtures</code> namespace, you can
change this behavior with config or command options. You can exclude some fixtures due load or unload by specifying <code>-</code> before its name like <code>-User</code>.</p>
<p>To load fixture, run the following command:</p>
<pre><code class="hljs nginx"><span class="hljs-title">yii</span> fixture/load &lt;fixture_name&gt;
</code></pre>
<p>The required <code>fixture_name</code> parameter specifies a fixture name which data will be loaded. You can load several fixtures at once.
Below are correct formats of this command:</p>
<pre><code class="hljs sql">// <span class="hljs-operator"><span class="hljs-keyword">load</span> <span class="hljs-string">`User`</span> fixture
yii fixture/<span class="hljs-keyword">load</span> <span class="hljs-keyword">User</span>

// same <span class="hljs-keyword">as</span> above, because <span class="hljs-keyword">default</span> <span class="hljs-keyword">action</span> <span class="hljs-keyword">of</span> <span class="hljs-string">"fixture"</span> command <span class="hljs-keyword">is</span> <span class="hljs-string">"load"</span>
yii fixture <span class="hljs-keyword">User</span>

// <span class="hljs-keyword">load</span> several fixtures
yii fixture <span class="hljs-string">"User, UserProfile"</span>

// <span class="hljs-keyword">load</span> all fixtures
yii fixture/<span class="hljs-keyword">load</span> <span class="hljs-string">"*"</span>

// same <span class="hljs-keyword">as</span> above
yii fixture <span class="hljs-string">"*"</span>

// <span class="hljs-keyword">load</span> all fixtures <span class="hljs-keyword">except</span> ones
yii fixture <span class="hljs-string">"*, -DoNotLoadThisOne"</span>

// <span class="hljs-keyword">load</span> fixtures, but <span class="hljs-keyword">search</span> them <span class="hljs-keyword">in</span> different namespace. <span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span> namespace <span class="hljs-keyword">is</span>: tests\unit\fixtures.
yii fixture <span class="hljs-keyword">User</span> <span class="hljs-comment">--namespace='alias\my\custom\namespace'</span>

// <span class="hljs-keyword">load</span> <span class="hljs-keyword">global</span> fixture <span class="hljs-string">`some\name\space\CustomFixture`</span> <span class="hljs-keyword">before</span> other fixtures will be loaded.
// <span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span> this <span class="hljs-keyword">option</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> <span class="hljs-string">`InitDbFixture`</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">disable</span>/<span class="hljs-keyword">enable</span> integrity checks. You can specify several
// <span class="hljs-keyword">global</span> fixtures separated <span class="hljs-keyword">by</span> comma.
yii fixture <span class="hljs-keyword">User</span> <span class="hljs-comment">--globalFixtures='some\name\space\Custom'</span>
</span></code></pre>
<h2>Unloading fixtures <span id="unloading-fixtures"></span><a href="#unloading-fixtures" class="hashlink">&para;</a></h2><p>To unload fixture, run the following command:</p>
<pre><code class="hljs javascript"><span class="hljs-comment">// unload Users fixture, by default it will clear fixture storage (for example "users" table, or "users" collection if this is mongodb fixture).</span>
yii fixture/unload User

<span class="hljs-comment">// Unload several fixtures</span>
yii fixture/unload <span class="hljs-string">"User, UserProfile"</span>

<span class="hljs-comment">// unload all fixtures</span>
yii fixture/unload <span class="hljs-string">"*"</span>

<span class="hljs-comment">// unload all fixtures except ones</span>
yii fixture/unload <span class="hljs-string">"*, -DoNotUnloadThisOne"</span>

</code></pre>
<p>Same command options like: <code>namespace</code>, <code>globalFixtures</code> also can be applied to this command.</p>
<h2>Configure Command Globally <span id="configure-command-globally"></span><a href="#configure-command-globally" class="hashlink">&para;</a></h2><p>While command line options allow us to configure the migration command
on-the-fly, sometimes we may want to configure the command once for all. For example you can configure
different migration path as follows:</p>
<pre><code class="hljs php"><span class="hljs-string">'controllerMap'</span> =&gt; [
    <span class="hljs-string">'fixture'</span> =&gt; [
        <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\console\controllers\FixtureController'</span>,
        <span class="hljs-string">'namespace'</span> =&gt; <span class="hljs-string">'myalias\some\custom\namespace'</span>,
        <span class="hljs-string">'globalFixtures'</span> =&gt; [
            <span class="hljs-string">'some\name\space\Foo'</span>,
            <span class="hljs-string">'other\name\space\Bar'</span>
        ],
    ],
]
</code></pre>
<h2>Auto-generating fixtures <span id="auto-generating-fixtures"></span><a href="#auto-generating-fixtures" class="hashlink">&para;</a></h2><p>Yii also can auto-generate fixtures for you based on some template. You can generate your fixtures with different data on different languages and formats.
These feature is done by <a href="https://github.com/fzaninotto/Faker">Faker</a> library and <code>yii2-faker</code> extension.
See extension <a href="https://github.com/yiisoft/yii2-faker">guide</a> for more docs.</p>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Tue, 27 Dec 2016 22:28:43 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
