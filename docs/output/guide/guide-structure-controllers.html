<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/90d046f2/css/bootstrap.css" rel="stylesheet">
<link href="./assets/c6368d94/solarized_light.css" rel="stylesheet">
<link href="./assets/9f5cdd92/style.css" rel="stylesheet">
<script src="./assets/a6e53573/jquery.js"></script>
<script src="./assets/90d046f2/js/bootstrap.js"></script>
<script src="./assets/218ce2e5/jssearch.js"></script>    <title>Bộ điều khiển (Controllers) - Kiến trúc ứng dụng (Application Structure) - The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w11158" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w11158-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./guide-index.html">The Definitive Guide to Yii 2.0</a></div><div id="w11158-collapse" class="collapse navbar-collapse"><ul id="w11159" class="navbar-nav nav"><li><a href="./guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-11142" data-toggle="collapse" data-parent="#navigation">Giới thiệu <b class="caret"></b></a><div id="navigation-11142" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-intro-yii.html">Về Yii</a>
<a class="list-group-item" href="./guide-intro-upgrade-from-v1.html">Nâng cấp lên từ phiên bản 1.1</a></div>
<a class="list-group-item" href="#navigation-11143" data-toggle="collapse" data-parent="#navigation">Bắt đầu <b class="caret"></b></a><div id="navigation-11143" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-start-installation.html">Cài đặt Yii</a>
<a class="list-group-item" href="./guide-start-workflow.html">Thực hiện chạy ứng dụng</a>
<a class="list-group-item" href="./guide-start-hello.html">Viết lời chào đầu tiên</a>
<a class="list-group-item" href="./guide-start-forms.html">Làm việc với Forms</a>
<a class="list-group-item" href="./guide-start-databases.html">Làm việc với Databases</a>
<a class="list-group-item" href="./guide-start-gii.html">Sử dụng Gii để sinh code</a>
<a class="list-group-item" href="./guide-start-looking-ahead.html">Mức cao hơn</a></div>
<a class="list-group-item active" href="#navigation-11144" data-toggle="collapse" data-parent="#navigation">Kiến trúc ứng dụng (Application Structure) <b class="caret"></b></a><div id="navigation-11144" class="submenu panel-collapse collapse in"><a class="list-group-item" href="./guide-structure-overview.html">Tổng quan về kiến trúc ứng dụng</a>
<a class="list-group-item" href="./guide-structure-entry-scripts.html">Mục Scripts</a>
<a class="list-group-item" href="./guide-structure-applications.html">Ứng dụng (Applications)</a>
<a class="list-group-item" href="./guide-structure-application-components.html">Thành phần ứng dụng</a>
<a class="list-group-item active" href="./guide-structure-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-structure-models.html">Models</a>
<a class="list-group-item" href="./guide-structure-views.html">Views</a>
<a class="list-group-item" href="./guide-structure-modules.html">Modules</a>
<a class="list-group-item" href="./guide-structure-filters.html">Bộ lọc (Filters)</a>
<a class="list-group-item" href="./guide-structure-widgets.html">Widgets</a>
<a class="list-group-item" href="./guide-structure-assets.html">Assets</a>
<a class="list-group-item" href="./guide-structure-extensions.html">Phần mở rộng (Extensions)</a></div>
<a class="list-group-item" href="#navigation-11145" data-toggle="collapse" data-parent="#navigation">Yêu cầu xử lý (Handling Requests) <b class="caret"></b></a><div id="navigation-11145" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-runtime-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="./guide-runtime-routing.html">Routing và URL Creation</a>
<a class="list-group-item" href="./guide-runtime-requests.html">Yêu cầu (Requests)</a>
<a class="list-group-item" href="./guide-runtime-responses.html">Responses</a>
<a class="list-group-item" href="./guide-runtime-sessions-cookies.html">Sessions và Cookies</a>
<a class="list-group-item" href="./guide-runtime-handling-errors.html">Xử lý lỗi (Handling Error)</a>
<a class="list-group-item" href="./guide-runtime-logging.html">Logging</a></div>
<a class="list-group-item" href="#navigation-11146" data-toggle="collapse" data-parent="#navigation">Các khái niệm chính <b class="caret"></b></a><div id="navigation-11146" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-concept-components.html">Thành phần (Components)</a>
<a class="list-group-item" href="./guide-concept-properties.html">Thuộc tính (Properties)</a>
<a class="list-group-item" href="./guide-concept-events.html">Sự kiện (Events)</a>
<a class="list-group-item" href="./guide-concept-behaviors.html">Hành vi (Behaviors)</a>
<a class="list-group-item" href="./guide-concept-configurations.html">Cấu hình (Configurations)</a>
<a class="list-group-item" href="./guide-concept-aliases.html">Bí danh (Aliases)</a>
<a class="list-group-item" href="./guide-concept-autoloading.html">Lớp tự động nạp (Autoloading)</a>
<a class="list-group-item" href="./guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="./guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item" href="#navigation-11147" data-toggle="collapse" data-parent="#navigation">Làm việc với Databases <b class="caret"></b></a><div id="navigation-11147" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-db-dao.html">Data Access Objects</a>
<a class="list-group-item" href="./guide-db-query-builder.html">Query Builder</a>
<a class="list-group-item" href="./guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="./guide-db-migrations.html">Migrations</a>
<a class="list-group-item" href="./guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="./guide-db-redis.html">Redis</a>
<a class="list-group-item" href="./guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="./guide-db-elasticsearch.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-11148" data-toggle="collapse" data-parent="#navigation">Nhận dữ liệu từ user <b class="caret"></b></a><div id="navigation-11148" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-input-forms.html">Tạo mới Forms</a>
<a class="list-group-item" href="./guide-input-validation.html">Kiểm tra dữ liệu đầu vào (Validating Input)</a>
<a class="list-group-item" href="./guide-input-file-upload.html">File Upload</a>
<a class="list-group-item" href="./guide-input-tabular-input.html">Thu thập dữ liệu từ danh sách đầu vào (Đang phát triển)</a>
<a class="list-group-item" href="./guide-input-multiple-models.html">Lấy dữ liệu cho nhiều Models (Chưa giải quyết)</a></div>
<a class="list-group-item" href="#navigation-11149" data-toggle="collapse" data-parent="#navigation">Hiển thị dữ liệu <b class="caret"></b></a><div id="navigation-11149" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-output-formatter.html">Định dạng dữ liệu (Data Formatting)</a>
<a class="list-group-item" href="./guide-output-pagination.html">Phân trang (Pagination)</a>
<a class="list-group-item" href="./guide-output-sorting.html">Sắp xếp (Sorting)</a>
<a class="list-group-item" href="./guide-output-data-providers.html">Cung cấp dữ liệu ra (Data Providers)</a>
<a class="list-group-item" href="./guide-output-data-widgets.html">Dữ liệu Widgets</a>
<a class="list-group-item" href="./guide-output-client-scripts.html">làm việc với Client Scripts</a>
<a class="list-group-item" href="./guide-output-theming.html">Giao diện (Theming)</a></div>
<a class="list-group-item" href="#navigation-11150" data-toggle="collapse" data-parent="#navigation">Bảo mật (Security) <b class="caret"></b></a><div id="navigation-11150" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-security-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-security-authorization.html">Quyền (Authorization)</a>
<a class="list-group-item" href="./guide-security-passwords.html">Các thao tác xử lý với Passwords (Đang phát triển)</a>
<a class="list-group-item" href="./guide-security-auth-clients.html">Auth Clients</a>
<a class="list-group-item" href="./guide-security-best-practices.html">Best Practices</a></div>
<a class="list-group-item" href="#navigation-11151" data-toggle="collapse" data-parent="#navigation">Bộ nhớ Cache <b class="caret"></b></a><div id="navigation-11151" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-caching-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-caching-data.html">Cache dữ liệu</a>
<a class="list-group-item" href="./guide-caching-fragment.html">Fragment Caching</a>
<a class="list-group-item" href="./guide-caching-page.html">Page Caching</a>
<a class="list-group-item" href="./guide-caching-http.html">HTTP Caching</a></div>
<a class="list-group-item" href="#navigation-11152" data-toggle="collapse" data-parent="#navigation">RESTful Web Services <b class="caret"></b></a><div id="navigation-11152" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-rest-quick-start.html">Bắt đầu</a>
<a class="list-group-item" href="./guide-rest-resources.html">Tài nguyên (Resources)</a>
<a class="list-group-item" href="./guide-rest-controllers.html">Bộ điều khiển (Controllers)</a>
<a class="list-group-item" href="./guide-rest-routing.html">Routing</a>
<a class="list-group-item" href="./guide-rest-response-formatting.html">Định dạng thông điệp gửi đi (Response Formatting)</a>
<a class="list-group-item" href="./guide-rest-authentication.html">Xác thực (Authentication)</a>
<a class="list-group-item" href="./guide-rest-rate-limiting.html">Rate Limiting</a>
<a class="list-group-item" href="./guide-rest-versioning.html">Phiên bản (Version)</a>
<a class="list-group-item" href="./guide-rest-error-handling.html">Error Handling</a></div>
<a class="list-group-item" href="#navigation-11153" data-toggle="collapse" data-parent="#navigation">Công cụ phát triển (Development Tools) <b class="caret"></b></a><div id="navigation-11153" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tool-debugger.html">Thanh công cụ gỡ lỗi và sửa lỗi (Debug Toolbar và Debugger)</a>
<a class="list-group-item" href="./guide-tool-gii.html">Sử dụng Gii để tạo code</a>
<a class="list-group-item" href="./guide-tool-api-doc.html">Tạo tài liệu về API </a></div>
<a class="list-group-item" href="#navigation-11154" data-toggle="collapse" data-parent="#navigation">Testing <b class="caret"></b></a><div id="navigation-11154" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-test-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-test-environment-setup.html">Thiết lập môi trường</a>
<a class="list-group-item" href="./guide-test-unit.html">Unit Tests</a>
<a class="list-group-item" href="./guide-test-functional.html">Kiểm tra chức năng (Functional Tests)</a>
<a class="list-group-item" href="./guide-test-acceptance.html">Acceptance Tests</a>
<a class="list-group-item" href="./guide-test-fixtures.html">Fixtures</a></div>
<a class="list-group-item" href="#navigation-11155" data-toggle="collapse" data-parent="#navigation">Chủ đề năng cao <b class="caret"></b></a><div id="navigation-11155" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-tutorial-advanced-app.html">Advanced Application Template</a>
<a class="list-group-item" href="./guide-tutorial-start-from-scratch.html">Building Application from Scratch</a>
<a class="list-group-item" href="./guide-tutorial-console.html">Giao diện dòng lệnh (Console Commands)</a>
<a class="list-group-item" href="./guide-tutorial-core-validators.html">Core Validators</a>
<a class="list-group-item" href="./guide-tutorial-i18n.html">Quốc tế hóa (Internationalization)</a>
<a class="list-group-item" href="./guide-tutorial-mailing.html">Thư (Mailing)</a>
<a class="list-group-item" href="./guide-tutorial-performance-tuning.html">Tối ưu hiệu năng ứng dụng (Performance Tuning)</a>
<a class="list-group-item" href="./guide-tutorial-shared-hosting.html">Shared Hosting Environment</a>
<a class="list-group-item" href="./guide-tutorial-template-engines.html">Template Engines</a>
<a class="list-group-item" href="./guide-tutorial-yii-integration.html">Working with Third-Party Code</a></div>
<a class="list-group-item" href="#navigation-11156" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-11156" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-widget-bootstrap.html">Bootstrap Widgets</a>
<a class="list-group-item" href="./guide-widget-jui.html">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-11157" data-toggle="collapse" data-parent="#navigation">Helpers <b class="caret"></b></a><div id="navigation-11157" class="submenu panel-collapse collapse"><a class="list-group-item" href="./guide-helper-overview.html">Tổng quan</a>
<a class="list-group-item" href="./guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="./guide-helper-html.html">Html</a>
<a class="list-group-item" href="./guide-helper-url.html">Url</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>コントローラ <span id="kontorora"></span><a href="#kontorora" class="hashlink">&para;</a></h1>
<div class="toc"><ol><li><a href="#actions">アクション</a></li>
<li><a href="#routes">ルート</a></li>
<li><a href="#creating-controllers">コントローラを作成する</a></li>
<li><a href="#creating-actions">アクションを作成する</a></li>
<li><a href="#controller-lifecycle">コントローラのライフサイクル</a></li>
<li><a href="#best-practices">ベストプラクティス</a></li></ol></div>
<p>コントローラは <a href="http://ja.wikipedia.org/wiki/Model_View_Controller">MVC</a> アーキテクチャの一部を成すものです。
それは <span class="broken-link">yii\base\Controller</span> を拡張したクラスのオブジェクトであり、リクエストの処理とレスポンスの生成について責任を負います。
具体的には、<a href="guide-structure-applications.html">アプリケーション</a> から制御を引き継いだ後、コントローラは入ってきたリクエストのデータを分析し、それを <a href="guide-structure-models.html">モデル</a> に引き渡して、モデルが生成した結果を <a href="guide-structure-views.html">ビュー</a> に投入し、最終的に外に出て行くレスポンスを生成します。</p>
<h2>アクション  <span id="actions"></span><a href="#actions" class="hashlink">&para;</a></h2><p>コントローラは、エンドユーザがアドレスを指定して実行をリクエストできる最も基本的なユニットである <em>アクション</em> から構成されます。
コントローラは一つまたは複数のアクションを持つことが出来ます。</p>
<p>次の例は、<code>view</code> と <code>create</code> という二つのアクションを持つ <code>post</code> コントローラを示すものです。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Yii</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">models</span>\<span class="hljs-title">Post</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">NotFoundHttpException</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionView</span><span class="hljs-params">(<span class="hljs-variable">$id</span>)</span>
    </span>{
        <span class="hljs-variable">$model</span> = Post::findOne(<span class="hljs-variable">$id</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$model</span> === <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotFoundHttpException;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'view'</span>, [
            <span class="hljs-string">'model'</span> =&gt; <span class="hljs-variable">$model</span>,
        ]);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionCreate</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable">$model</span> = <span class="hljs-keyword">new</span> Post;

        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$model</span>-&gt;load(Yii::<span class="hljs-variable">$app</span>-&gt;request-&gt;post()) &amp;&amp; <span class="hljs-variable">$model</span>-&gt;save()) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;redirect([<span class="hljs-string">'view'</span>, <span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$model</span>-&gt;id]);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'create'</span>, [
                <span class="hljs-string">'model'</span> =&gt; <span class="hljs-variable">$model</span>,
            ]);
        }
    }
}
</code></pre>
<p><code>view</code> アクション (<code>actionView()</code> メソッドで定義されます) において、コードは最初に、リクエストされたモデルの ID に従って <a href="guide-structure-models.html">モデル</a> を読み出します。
モデルの読み出しが成功したときは、<code>view</code> という名前の <a href="guide-structure-views.html">ビュー</a> を使ってモデルを表示します。
失敗したときは例外を投げます。</p>
<p><code>create</code> アクション (<code>actionCreate()</code> メソッドで定義されます) においても、コードは似たようなものです。
最初に、リクエストデータを使って <a href="guide-structure-models.html">モデル</a> の新しいインスタンスにデータを投入することを試み、そして、モデルを保存することを試みます。
両方が成功したときは、新しく作成されたモデルの ID を使って <code>view</code> アクションにブラウザをリダイレクトします。
どちらかが失敗したときは、ユーザが必要なデータを入力できるようにするための <code>create</code> ビューを表示します。</p>
<h2>ルート  <span id="routes"></span><a href="#routes" class="hashlink">&para;</a></h2><p>エンドユーザは、いわゆる <em>ルート</em> によって、アクションのアドレスを指定します。
ルートは、次の部分からなる文字列です。</p>
<ul>
<li>モジュール ID: この部分は、コントローラがアプリケーションではない <a href="guide-structure-modules.html">モジュール</a> に属する場合にのみ存在します。</li>
<li>[コントローラ ID]((#controller-ids): 同じアプリケーション (または、コントローラがモジュールに属する場合は、同じモジュール) に属する全てのコントローラの中から、コントローラを一意に特定する文字列。</li>
<li><a href="#action-ids">アクション ID</a>: 同じコントローラに属する全てのアクションの中から、アクションを一意に特定する文字列。</li>
</ul>
<p>ルートは次の形式を取ります。</p>
<pre><code class="hljs ">ControllerID/ActionID
</code></pre>
<p>または、コントローラがモジュールに属する場合は、次の形式を取ります。</p>
<pre><code class="hljs php language-php">ModuleID/ControllerID/ActionID
</code></pre>
<p>ですから、ユーザが <code>http://hostname/index.php?r=site/index</code> という URL でリクエストをした場合は、<code>site</code> コントローラの中の <code>index</code> アクションが実行されます。
ルートがどのようにしてアクションとして解決されるかについての詳細は、<a href="guide-runtime-routing.html">ルーティングと URL 生成</a> の節を参照してください。</p>
<h2>コントローラを作成する  <span id="creating-controllers"></span><a href="#creating-controllers" class="hashlink">&para;</a></h2><p><span class="broken-link">yii\web\Application</span> では、コントローラは <span class="broken-link">yii\web\Controller</span> またはその子クラスから派生させなければなりません。
同様に、<span class="broken-link">yii\console\Application</span> では、コントローラは <span class="broken-link">yii\console\Controller</span> またはその子クラスから派生させなければなりません。
次のコードは <code>site</code> コントローラを定義するものです。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
}
</code></pre>
<h3>コントローラ ID  <span id="controller-ids"></span><a href="#controller-ids" class="hashlink">&para;</a></h3><p>通常、コントローラは特定のタイプのリソースに関するリクエストを処理するように設計されます。
この理由により、たいていは、処理するリソースのタイプを示す名詞をコントローラの ID として使います。
例えば、記事データを処理するコントローラの ID としては、<code>article</code> を使うことが出来ます。</p>
<p>デフォルトでは、コントローラ ID は、小文字の英字、数字、アンダースコア、ダッシュ、および、フォワードスラッシュのみを含むべきものです。
例えば、<code>article</code> と <code>post-comment</code> はともに有効なコントローラ ID ですが、<code>article?</code>、<code>PostComment</code>、<code>admin\post</code> はそうではありません。</p>
<p>コントローラ ID は、サブディレクトリの接頭辞を含んでも構いません。
例えば、<code>admin/article</code> は、<span class="broken-link">yii\base\Application::controllerNamespace</span> の下の <code>admin</code> サブディレクトリにある <code>article</code> コントローラを表します。
サブディレクトリの接頭辞として有効な文字は、小文字または大文字の英字、数字、アンダースコア、そして、フォワードスラッシュです。
フォワードスラッシュは、複数レベルのサブディレクトリの区切り文字として使われます (例えば、<code>panels/admin</code>)。</p>
<h3>コントローラクラスの命名規則  <span id="controller-class-naming"></span><a href="#controller-class-naming" class="hashlink">&para;</a></h3><p>コントローラクラスの名前は下記の手順に従ってコントローラ ID から導出することが出来ます。</p>
<ol>
<li>ハイフンで区切られた各単語の最初の文字を大文字に変える。
コントローラ ID がスラッシュを含む場合、この規則は ID の最後のスラッシュの後ろの部分にのみ適用されることに注意。</li>
<li>ハイフンを削除し、フォワードスラッシュを全てバックワードスラッシュに置き換える。</li>
<li>接尾辞 <code>Controller</code> を追加する。</li>
<li><span class="broken-link">yii\base\Application::controllerNamespace</span> を頭に付ける。</li>
</ol>
<p>以下は、<span class="broken-link">yii\base\Application::controllerNamespace</span> がデフォルト値 <code>app\controllers</code> を取っていると仮定したときの、いくつかの例です。</p>
<ul>
<li><code>article</code> は <code>app\controllers\ArticleController</code> になる。</li>
<li><code>post-comment</code> は <code>app\controllers\PostCommentController</code> になる。</li>
<li><code>admin/post-comment</code> は <code>app\controllers\admin\PostCommentController</code> になる。</li>
<li><code>adminPanels/post-comment</code> は <code>app\controllers\adminPanels\PostCommentController</code> になる。</li>
</ul>
<p>コントローラクラスは <a href="guide-concept-autoloading.html">オートロード可能</a> でなければなりません。
この理由により、上記の例の <code>aritcle</code> コントローラクラスは <a href="guide-concept-aliases.html">エイリアス</a> が <code>@app/controllers/ArticleController.php</code> であるファイルに保存されるべきものとなります。
一方、<code>admin/post-comment</code> コントローラは <code>@app/controllers/admin/PostCommentController.php</code> というエイリアスのファイルに保存されるべきものとなります。</p>
<blockquote class="info"><p><strong>Info: </strong>最後の例である <code>admin/post-comment</code> は、どうすれば <span class="broken-link">yii\base\Application::controllerNamespace</span> のサブディレクトリにコントローラを置くことが出来るかを示しています。
  この方法は、コントローラをいくつかのカテゴリに分けて編成したい、けれども <a href="guide-structure-modules.html">モジュール</a> は使いたくない、という場合に役立ちます。</p>
</blockquote>
<h3>コントローラマップ  <span id="controller-map"></span><a href="#controller-map" class="hashlink">&para;</a></h3><p><span class="broken-link">yii\base\Application::controllerMap</span> を構成すると、上で述べたコントローラ ID とクラス名の制約を乗り越えることが出来ます。
これは、主として、クラス名に対する制御が及ばないサードパーティのコントローラを使おうとする場合に有用です。</p>
<p><span class="broken-link">yii\base\Application::controllerMap</span> は <a href="guide-structure-applications.html#application-configurations">アプリケーションの構成情報</a> の中で、次のように構成することが出来ます。</p>
<pre><code class="hljs php language-php">[
    <span class="hljs-string">'controllerMap'</span> =&gt; [
        <span class="hljs-comment">// クラス名を使って "account" コントローラを宣言する</span>
        <span class="hljs-string">'account'</span> =&gt; <span class="hljs-string">'app\controllers\UserController'</span>,

        <span class="hljs-comment">// 構成情報配列を使って "article" コントローラを宣言する</span>
        <span class="hljs-string">'article'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'app\controllers\PostController'</span>,
            <span class="hljs-string">'enableCsrfValidation'</span> =&gt; <span class="hljs-keyword">false</span>,
        ],
    ],
]
</code></pre>
<h3>デフォルトコントローラ  <span id="default-controller"></span><a href="#default-controller" class="hashlink">&para;</a></h3><p>全てのアプリケーションは、それぞれ、<span class="broken-link">yii\base\Application::defaultRoute</span> プロパティによって指定されるデフォルトコントローラを持ちます。
リクエストが <a href="#routes">ルート</a> を指定していない場合、このプロパティによって指定されたルートが使われます。
<span class="broken-link">yii\web\Application</span> では、この値は <code>'site'</code> であり、一方、<span class="broken-link">yii\console\Application</span> では、<code>help</code> です。
従って、URL が <code>http://hostname/index.php</code> である場合は、<code>site</code> コントローラがリクエストを処理することになります。</p>
<p>次のように <a href="guide-structure-applications.html#application-configurations">アプリケーションの構成情報</a> を構成して、デフォルトコントローラを変更することが出来ます。</p>
<pre><code class="hljs php language-php">[
    <span class="hljs-string">'defaultRoute'</span> =&gt; <span class="hljs-string">'main'</span>,
]
</code></pre>
<h2>アクションを作成する  <span id="creating-actions"></span><a href="#creating-actions" class="hashlink">&para;</a></h2><p>アクションは、コントローラクラスの中にいわゆる <em>アクションメソッド</em> を定義するだけで簡単に作成することが出来ます。
アクションメソッドとは、<code>action</code> という語で始まる名前を持つ <em>public</em> メソッドのことです。
アクションメソッドの返り値がエンドユーザに送信されるレスポンスデータを表します。
次のコードは、<code>index</code> と <code>hello-world</code> という二つのアクションを定義するものです。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionIndex</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'index'</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionHelloWorld</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello World'</span>;
    }
}
</code></pre>
<h3>アクション ID  <span id="action-ids"></span><a href="#action-ids" class="hashlink">&para;</a></h3><p>アクションは、たいてい、あるリソースについて特定の操作を実行するように設計されます。
この理由により、アクション ID は、通常、<code>view</code>、<code>update</code> などのような動詞になります。</p>
<p>デフォルトでは、アクション ID は、小文字の英字、数字、アンダースコア、そして、ハイフンのみを含むべきものです。
アクション ID の中のハイフンは単語を分けるために使われます。
例えば、<code>view</code>、<code>update2</code>、<code>comment-post</code> は全て有効なアクション ID ですが、<code>view?</code>、<code>Update</code> はそうではありません。</p>
<p>アクションは二つの方法、すなわち、インラインアクションまたはスタンドアロンアクションとして作成することが出来ます。
インラインアクションはコントローラクラスのメソッドとして定義されるものであり、一方、スタンドアロンアクションは <span class="broken-link">yii\base\Action</span> またはその子クラスを拡張するクラスです。
インラインアクションは作成するのにより少ない労力を要するため、通常は、アクションを再利用する意図がない場合に推奨されます。
もう一方のスタンドアロンアクションは、主として、さまざまなコントローラの中で使われることや、<a href="guide-structure-extensions.html">エクステンション</a> として再配布されることを目的として作成されます。</p>
<h3>インラインアクション  <span id="inline-actions"></span><a href="#inline-actions" class="hashlink">&para;</a></h3><p>インラインアクションは、たった今説明したように、アクションメソッドの形で定義されるアクションを指します。</p>
<p>アクションメソッドの名前は、次の手順に従って、アクション ID から導出されます。</p>
<ol>
<li>アクション ID に含まれる各単語の最初の文字を大文字に変換する。</li>
<li>ハイフンを削除する。</li>
<li>接頭辞 <code>action</code> を付ける。</li>
</ol>
<p>例えば、<code>index</code> は <code>actionIndex</code> となり、<code>hello-world</code> は <code>actionHelloWorld</code> となります。</p>
<blockquote class="note"><p><strong>Note: </strong>アクションメソッドの名前は、<em>大文字と小文字を区別</em> します。
  <code>ActionIndex</code> という名前のメソッドがあっても、それはアクションメソッドとは見なされず、結果として、<code>index</code> アクションに対するリクエストは例外に帰結します。
  アクションメソッドが public でなければならない事にも注意してください。
  private や protected なメソッドがインラインアクションを定義することはありません。</p>
</blockquote>
<p>インラインアクションは作成するのにほとんど労力を要さないため、たいていのアクションはインラインアクションとして定義されます。
しかし、同じアクションを別の場所で再利用する計画を持っていたり、また、アクションを再配布したいと思っていたりする場合は、アクションを <em>スタンドアロンアクション</em> として定義することを検討すべきです。</p>
<h3>スタンドアロンアクション  <span id="standalone-actions"></span><a href="#standalone-actions" class="hashlink">&para;</a></h3><p>スタンドアロンアクションは、<span class="broken-link">yii\base\Action</span> またはその子クラスを拡張するアクションクラスの形で定義されるものです。
例えば、Yii のリリースに <span class="broken-link">yii\web\ViewAction</span> と <span class="broken-link">yii\web\ErrorAction</span> が含まれていますが、これらは両方ともスタンドアロンアクションです。</p>
<p>スタンドアロンアクションを使用するためには、下記のように、コントローラの <span class="broken-link">yii\base\Controller::actions()</span> メソッドをオーバーライドして、<em>アクションマップ</em> の中でスタンドアロンアクションを宣言しなければなりません。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actions</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> [
        <span class="hljs-comment">// クラス名を使って "error" アクションを宣言する</span>
        <span class="hljs-string">'error'</span> =&gt; <span class="hljs-string">'yii\web\ErrorAction'</span>,

        <span class="hljs-comment">// 構成情報配列を使って "view" アクションを宣言する</span>
        <span class="hljs-string">'view'</span> =&gt; [
            <span class="hljs-string">'class'</span> =&gt; <span class="hljs-string">'yii\web\ViewAction'</span>,
            <span class="hljs-string">'viewPrefix'</span> =&gt; <span class="hljs-string">''</span>,
        ],
    ];
}
</code></pre>
<p>ご覧のように、<code>actions()</code> メソッドは、キーがアクション ID であり、値が対応するアクションのクラス名または <a href="guide-concept-configurations.html">構成情報</a> である配列を返さなければなりません。
インラインアクションと違って、スタンドアロンアクションのアクション ID は、<code>actions()</code> メソッドにおいて宣言される限りにおいて、任意の文字を含むことが出来ます。</p>
<p>スタンドアロンアクションクラスを作成するためには、<span class="broken-link">yii\base\Action</span> またはその子クラスを拡張して、<code>run()</code> という名前の public メソッドを実装しなければなりません。
<code>run()</code> メソッドの役割はアクションメソッドのそれと似たようなものです。例えば、</p>
<pre><code class="hljs php language-php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">components</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">base</span>\<span class="hljs-title">Action</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Action</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World"</span>;
    }
}
</code></pre>
<h3>アクションの結果  <span id="action-results"></span><a href="#action-results" class="hashlink">&para;</a></h3><p>アクションメソッド、または、スタンドアロンアクションの <code>run()</code> メソッドの返り値は、重要な意味を持ちます。
それは、対応するアクションの結果を表すものです。</p>
<p>返り値は、エンドユーザにレスポンスとして送信される <a href="guide-runtime-responses.html">レスポンス</a> オブジェクトとすることが出来ます。</p>
<ul>
<li><span class="broken-link">yii\web\Application</span> では、返り値を <span class="broken-link">yii\web\Response::data</span> に割り当てられる任意のデータとすることも出来ます。このデータは、後に、レスポンスの本文を表す文字列へと変換されます。</li>
<li><span class="broken-link">yii\console\Application</span> では、返り値をコマンド実行の <span class="broken-link">yii\console\Response::exitStatus</span> を示す整数とすることも出来ます。</li>
</ul>
<p>これまでに示した例においては、アクションの結果はすべて文字列であり、エンドユーザに送信されるレスポンスの本文として扱われるものでした。
次の例では、アクションがレスポンスオブジェクトを返すことによって、ユーザのブラウザを新しい URL にリダイレクトすることが出来る様子が示されています
(<span class="broken-link">yii\web\Controller::redirect()</span> メソッドの返り値はレスポンスオブジェクトです)。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionForward</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// ユーザのブラウザを http://example.com にリダイレクトする</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;redirect(<span class="hljs-string">'http://example.com'</span>);
}
</code></pre>
<h3>アクションパラメータ  <span id="action-parameters"></span><a href="#action-parameters" class="hashlink">&para;</a></h3><p>インラインアクションのアクションメソッドと、スタンドアロンアクションの <code>run()</code> メソッドは、<em>アクションパラメータ</em> と呼ばれるパラメータを取ることが出来ます。
パラメータの値はリクエストから取得されます。
<span class="broken-link">yii\web\Application</span> では、各アクションパラメータの値は <code>$_GET</code> からパラメータ名をキーとして読み出されます。
<span class="broken-link">yii\console\Application</span> では、アクションパラメータはコマンドライン引数に対応します。</p>
<p>次の例では、<code>view</code> アクション (インラインアクションです) は、二つのパラメータ、すなわち、<code>$id</code> と <code>$version</code> を宣言しています。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionView</span><span class="hljs-params">(<span class="hljs-variable">$id</span>, <span class="hljs-variable">$version</span> = null)</span>
    </span>{
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>アクションパラメータには、次のように、さまざまなリクエストに応じて異なる値が投入されます。</p>
<ul>
<li><code>http://hostname/index.php?r=post/view&amp;id=123</code>: <code>$id</code> パラメータには <code>'123'</code> という値が入れられます。
一方、<code>version</code> というクエリパラメータは無いので、<code>$version</code> は <code>null</code> のままになります。</li>
<li><code>http://hostname/index.php?r=post/view&amp;id=123&amp;version=2</code>: <code>$id</code> および <code>$version</code> パラメータに、それぞれ、<code>'123'</code> と <code>'2'</code> が入ります。</li>
<li><code>http://hostname/index.php?r=post/view</code>: 必須の <code>$id</code> パラメータがリクエストで提供されていないため、 <span class="broken-link">yii\web\BadRequestHttpException</span> 例外が投げられます。</li>
<li><code>http://hostname/index.php?r=post/view&amp;id[]=123</code>: <code>$id</code> パラメータが予期しない配列値 <code>['123']</code> を受け取ろうとするため、<span class="broken-link">yii\web\BadRequestHttpException</span> 例外が投げられます。</li>
</ul>
<p>アクションパラメータに配列値を受け取らせたい場合は、次のように、パラメータに <code>array</code> の型ヒントを付けなければなりません。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionView</span><span class="hljs-params">(array <span class="hljs-variable">$id</span>, <span class="hljs-variable">$version</span> = null)</span>
</span>{
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>このようにすると、リクエストが <code>http://hostname/index.php?r=post/view&amp;id[]=123</code> である場合は、<code>$id</code> パラメータは <code>['123']</code> という値を受け取ります。
リクエストが <code>http://hostname/index.php?r=post/view&amp;id=123</code> である場合も、スカラ値 <code>'123'</code> が自動的に配列に変換されるため、<code>$id</code> パラメータは引き続き同じ配列値を受け取ります。</p>
<p>上記の例は主としてウェブアプリケーションでのアクションパラメータの動作を示すものです。
コンソールアプリケーションについては、<a href="guide-tutorial-console.html">コンソールコマンド</a> の節で詳細を参照してください。</p>
<h3>デフォルトアクション  <span id="default-action"></span><a href="#default-action" class="hashlink">&para;</a></h3><p>すべてのコントローラは、それぞれ、<span class="broken-link">yii\base\Controller::defaultAction</span> によって指定されるデフォルトアクションを持ちます。
<a href="#routes">ルート</a> がコントローラ ID のみを含む場合は、指定されたコントローラのデフォルトアクションがリクエストされたことを意味します。</p>
<p>デフォルトでは、デフォルトアクションは <code>index</code> と設定されます。
このデフォルト値を変更したい場合は、以下のように、コントローラクラスでこのプロパティをオーバーライドするだけです。</p>
<pre><code class="hljs php language-php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span>\<span class="hljs-title">Controller</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SiteController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-variable">$defaultAction</span> = <span class="hljs-string">'home'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">actionHome</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;render(<span class="hljs-string">'home'</span>);
    }
}
</code></pre>
<h2>コントローラのライフサイクル  <span id="controller-lifecycle"></span><a href="#controller-lifecycle" class="hashlink">&para;</a></h2><p>リクエストを処理するときに、<a href="guide-structure-applications.html">アプリケーション</a> はリクエストされた <a href="#routes">ルート</a> に基いてコントローラを作成します。
そして、次に、コントローラはリクエストに応じるために以下のライフサイクルを経過します。</p>
<ol>
<li>コントローラが作成され構成された後、<span class="broken-link">yii\base\Controller::init()</span> メソッドが呼ばれる。</li>
<li>コントローラは、リクエストされたアクション ID に基いて、アクションオブジェクトを作成する。<ul>
<li>アクション ID が指定されていないときは、<span class="broken-link">yii\base\Controller::defaultAction</span> が使われる。</li>
<li>アクション ID が <span class="broken-link">yii\base\Controller::actions()</span> の中に見つかった場合は、スタンドアロンアクションが作成される。</li>
<li>アクション ID に合致するアクションメソッドが見つかった場合は、インラインアクションが作成される。</li>
<li>上記以外の場合は、<span class="broken-link">yii\base\InvalidRouteException</span> 例外が投げられる。</li>
</ul>
</li>
<li>コントローラは、アプリケーション、(コントローラがモジュールに属する場合は) モジュール、そしてコントローラの <code>beforeAction()</code> メソッドをこの順で呼び出す。<ul>
<li>どれか一つの呼び出しが false を返した場合は、残りのまだ呼ばれていない <code>beforeAction()</code> メソッドはスキップされ、アクションの実行はキャンセルされる。</li>
<li>デフォルトでは、それぞれの <code>beforeAction()</code> メソッドは、ハンドラをアタッチすることが可能な <code>beforeAction</code> イベントをトリガする。</li>
</ul>
</li>
<li>コントローラがアクションを実行する。<ul>
<li>アクションパラメータが解析されて、リクエストデータからデータが投入される。</li>
</ul>
</li>
<li>コントローラは、コントローラ、(コントローラがモジュールに属する場合は) モジュール、そしてアプリケーションの <code>afterAction()</code> メソッドをこの順で呼び出す。<ul>
<li>デフォルトでは、それぞれの <code>afterAction()</code> メソッドは、ハンドラをアタッチすることが可能な <code>afterAction</code> イベントをトリガする。</li>
</ul>
</li>
<li>アプリケーションはアクションの結果を受け取り、それを <a href="guide-runtime-responses.html">レスポンス</a> に割り当てる。</li>
</ol>
<h2>ベストプラクティス  <span id="best-practices"></span><a href="#best-practices" class="hashlink">&para;</a></h2><p>良く設計されたアプリケーションでは、コントローラはたいてい非常に軽いものになり、それぞれのアクションは数行のコードしか含まないものになります。
あなたのコントローラが少々複雑になっている場合、そのことは、通常、コントローラをリファクタして、コードの一部を他のクラスに移動すべきことを示すものです。</p>
<p>いくつかのベストプラクティスを特に挙げるなら、コントローラは、</p>
<ul>
<li><a href="guide-runtime-requests.html">リクエスト</a> データにアクセスすることが出来ます。</li>
<li>リクエストデータを使って <a href="guide-structure-models.html">モデル</a> や他のサービスコンポーネントのメソッドを呼ぶことが出来ます。</li>
<li><a href="guide-structure-views.html">ビュー</a> を使ってレスポンスを構成することが出来ます。</li>
<li>リクエストされたデータの処理をするべきではありません - データは <a href="guide-structure-models.html">モデルのレイヤ</a> において処理されるべきです。</li>
<li>HTML を埋め込むなどの表示に関わるコードは避けるべきです - 表示は <a href="guide-structure-views.html">ビュー</a> で行う方が良いです。</li>
</ul>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Tue, 27 Dec 2016 22:28:42 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) setTimeout(shiftWindow, 1);
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
